---
title: ã€å‰ç«¯ç»„ä»¶åŒ–ã€‘ç³»åˆ—ç¬¬äºŒç¯‡â€”â€”monorepoæ–¹æ¡ˆå®æˆ˜
date: 2022-09-05 15:52:50
permalink: /pages/eb2149/
categories:
  - æ–‡ç« 
  - å‰ç«¯
tags:
  - monorepo
---

> å‰ç«¯ç»„ä»¶åŒ–ç³»åˆ—æ–‡ç« ç¬¬äºŒç¯‡
>
> ä¸€ä¸ªä½¿ç”¨ pnpm + workspace + changeset çš„ monorepo å¤šåŒ…ç®¡ç†ç»„ä»¶åŒ–é¡¹ç›®

<!-- more -->

## å‰è¨€

åœ¨ä¸Šä¸€ç¯‡çš„[æ–¹æ¡ˆæ¢ç©¶](01.ã€å‰ç«¯ç»„ä»¶åŒ–ã€‘ç³»åˆ—ç¬¬ä¸€ç¯‡.md)ä¸­ï¼Œæˆ‘ä»¬ææ¸…æ¥šäº†ä»€ä¹ˆæ˜¯ç»„ä»¶åŒ–ä»¥åŠæˆ‘ä»¬ä¸ºä»€ä¹ˆéœ€è¦ç»„ä»¶åŒ–çš„ä¸€äº›ç ”ç©¶å’Œè®¨è®ºã€‚ä¹Ÿè°ƒç ”å’Œæµ‹è¯•äº†ä¸€äº›å¼€æºé¡¹ç›®ï¼Œå¹¶ä¸”åœ¨ä½¿ç”¨ã€å­¦ä¹ ã€ç ”ç©¶ã€å¯¹æ¯”ä¹‹åæœ€ç»ˆç¡®å®šäº†ä»¥ pnpm + workspace + changeset ä¸ºæŠ€æœ¯æ–¹å‘çš„ monorepo å¤šåŒ…ç®¡ç†æ–¹æ¡ˆã€‚

- æœ¬æ–‡ä¸»è¦æ˜¯æ²¿ç€è¯¥è·¯çº¿è¿›è¡Œé¡¹ç›®è½åœ°ï¼Œæ˜¯ä¸€ç¯‡èšç„¦äºå®æˆ˜çš„æ–‡ç« ã€‚
- æ–‡ç« çš„ç›®æ ‡æ˜¯èƒ½å¤Ÿè®©æœªæ¥è§¦è¿‡monorepoçš„æ–°æ‰‹ä¹Ÿèƒ½ä»0åˆ°1çš„å®Œæˆä¸€ä¸ªå¤šåŒ…ç®¡ç†çš„å‰ç«¯ç»„ä»¶åŒ–é¡¹ç›®

ç»†è‡´ä¸€ç‚¹çš„è¯´ï¼Œæˆ‘ä»¬ä¸»è¦ä»è¿™å‡ ä¸ªæ–¹é¢å…¥æ‰‹ï¼š

1. monorepoé¡¹ç›®æ¶æ„çš„æ­å»º
2. æ•´ä¸ªé¡¹ç›®çš„å·¥ç¨‹åŒ–è§„èŒƒæ­å»º
3. å­é¡¹ç›®çš„é…ç½®å’Œæ„å»ºé…ç½®ï¼ŒåŒ…æ‹¬å‡ºå…¥å£ç®¡ç†ã€webpackæ‰“åŒ…
4. æ–‡æ¡£ç«™ç‚¹çš„æ­å»º
5. ç‰ˆæœ¬ç®¡ç†å’Œå‘å¸ƒ

## ä½¿ç”¨ pnpm å¿«é€Ÿæ­å»ºä¸€ä¸ª monorepo é¡¹ç›®

åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­æˆ‘ä»¬æè¿°äº†ä»€ä¹ˆæ˜¯`monorepo`ï¼Œä»¥åŠ`pnpm`çš„`workspace`å·¥ä½œç©ºé—´æ¦‚å¿µï¼Œç®€å•ç†è§£çš„è¯å°±æ˜¯ä¸¤ä¸ªæ–¹é¢ï¼š

- å¦‚ä½•é€šè¿‡ä¸€ä¸ªå·¥ç¨‹ç®¡ç†å¤šä¸ªé¡¹ç›®
- å¦‚ä½•é€šè¿‡ä¸€ä¸ªå·¥ç¨‹ç®¡ç†å¤šä¸ªé¡¹ç›®çš„ä¾èµ–ã€ç‰ˆæœ¬

è¿™é‡Œï¼Œæˆ‘ä»¬ä¸»è¦å›´ç»•è¿™ä¸¤ä¸ªæ ¸å¿ƒæ€æƒ³å±•å¼€å·¥ä½œã€‚

### åˆ›å»ºä¸»é¡¹ç›®

é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ªä¸»é¡¹ç›®ï¼Œåœ¨å‘½ä»¤è¡Œä¸­æ‰§è¡Œï¼š

1. `mkdir my-monorepo-app && cd my-monorepo-app`
2. `pnpm init`

æ¥ä¸‹æ¥æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª**packages**ç›®å½•ä½œä¸ºæˆ‘ä»¬çš„å­é¡¹ç›®ç›®å½•ä½¿ç”¨ï¼Œç„¶åå†åˆ›å»ºå‡ ä¸ªå­é¡¹ç›®ï¼Œå¦‚ä¸‹ï¼š

```js
â”œâ”€â”€ package.json       
â”œâ”€â”€ packages           // å­é¡¹ç›®ç›®å½•
  â”œâ”€â”€ components       // UIåŸºç¡€ç»„ä»¶
  â”œâ”€â”€ pro-sqltiptree   // é«˜çº§ä¸šåŠ¡ç»„ä»¶
  â”œâ”€â”€ utils            // å·¥å…·ç±»
```

åœ¨ä¸»ç›®å½•ä¸‹ç®€å•é…ç½®ä¸‹`.gitignore`ï¼š

```.gitignore
# IDE user config
.vscode/
.idea/
.vs/

/**/.DS_Store
/**/node_modules/
/**/.env

# /**/dist
docs/**/dist

# Logs
/**/yarn-error.log
/**/npm-debug.log
/**/.pnpm-debug.log
```

å› ä¸ºæ˜¯å¤šåŒ…é¡¹ç›®ï¼Œå­˜åœ¨ä¸»å’Œå­å…³ç³»çš„åµŒå¥—ç»“æ„ï¼Œè¿‡æ»¤è§„åˆ™éœ€è¦è€ƒè™‘å­ç›®å½•ä¸‹çš„æƒ…å†µï¼ˆ`/**/node_modules/`ï¼‰

å‡†å¤‡å·¥ä½œå·®ä¸å¤šäº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬é…ç½®ä¸‹å·¥ä½œç©ºé—´ï¼ˆ`workspace`ï¼‰ï¼Œä¸ºå®‰è£…npmåŒ…å’Œä¾èµ–ç®¡ç†åšå‡†å¤‡ã€‚

å…¶å®å¯¹äºä½¿ç”¨pnpmçš„é¡¹ç›®æ¥è¯´ï¼Œè¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨ä¸»ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª`pnpm-workspace.yaml` æ–‡ä»¶å³å¯å¼€å¯pnpmçš„å·¥ä½œç©ºé—´åŠŸèƒ½ã€‚

> pnpm å†…ç½®äº†å¯¹å•ä¸€å­˜å‚¨åº“ï¼ˆä¹Ÿç§°ä¸ºå¤šåŒ…å­˜å‚¨åº“ã€å¤šé¡¹ç›®å­˜å‚¨åº“æˆ–å•ä½“å­˜å‚¨åº“ï¼‰çš„æ”¯æŒï¼Œ ä½ å¯ä»¥åˆ›å»ºä¸€ä¸ª workspace ä»¥å°†å¤šä¸ªé¡¹ç›®åˆå¹¶åˆ°ä¸€ä¸ªä»“åº“ä¸­ã€‚

Workspace åè®®æ›´å¤šçš„æ˜¯å¯¹ä¸€ä¸ªé¡¹ç›®ä¸‹å¤šå­é¡¹ç›®çš„ç®¡ç†ä»¥åŠä¾èµ–ç®¡ç†ã€‚

æˆ‘ä»¬å…ˆæŠŠ`packages`ç›®å½•æ·»åŠ åˆ°å·¥ä½œç©ºé—´ä¸­ï¼Œ`pnpm-workspace.yaml`é…ç½®å¦‚ä¸‹ï¼š

```yml
packages:
  - packages/*
```

è¿™æ ·çš„è¯ï¼Œæ‰€æœ‰åœ¨ packages ç›®å½•ä¸‹çš„é¡¹ç›®éƒ½ä¼šè¢«å·¥ä½œç©ºé—´ç»Ÿä¸€æ¥ç®¡ï¼Œè¯¥ç›®å½•ä¸‹çš„å­é¡¹ç›®å¯ä»¥ç›¸äº’å¼•ç”¨ä¾èµ–ï¼Œè€Œä¸å¿…é‡å¤å®‰è£…ï¼Œå°¤å…¶æ˜¯é’ˆå¯¹æœ¬åœ°å¼€å‘åŒ…çš„ç®¡ç†ä½¿ç”¨ï¼Œæä¾›äº†æå¤§çš„æ–¹ä¾¿ï¼Œå…·ä½“ç»†èŠ‚æˆ‘ä»¬ç»§ç»­å¾€ä¸‹çœ‹~

### å®‰è£…ä¾èµ–

monorepoæœ€ä¸»è¦çš„åŠŸèƒ½å°±æ˜¯å¯¹äºä¾èµ–çš„ç®¡ç†

#### 1. å…¨å±€å…±ç”¨çš„ä¾èµ–

å¯¹äºä½¿ç”¨æ¯”è¾ƒé¢‘ç¹çš„ä¾èµ–ï¼Œåœ¨å¤šä¸ªå­é¡¹ç›®ä¸­éƒ½æœ‰ç”¨åˆ°çš„æƒ…å†µï¼Œæ¯”å¦‚æˆ‘ä»¬å½“å‰æŠ€æœ¯æ ˆä¸ºvue2ï¼Œé‚£ä¹ˆæ ¸å¿ƒåº“ `vue`ã€`vue-router`åŸºæœ¬éƒ½ä¼šç”¨åˆ°ï¼Œä¹ŸåŒ…æ‹¬ä¸€äº›é€šç”¨å·¥å…·ï¼Œå¦‚ `lodash`ã€`dayjs`ç­‰ï¼Œæ­¤æ—¶ï¼Œå°±å¯ä»¥é‡‡ç”¨å…¨å±€å®‰è£…çš„æ–¹å¼ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯æ‰€æœ‰çš„å­é¡¹ç›®éƒ½å¯ä»¥ç›´æ¥å¼•å…¥ä½¿ç”¨ï¼ˆæ­¤æ—¶çš„ä¾èµ–æ˜¯å®‰è£…åœ¨ä¸»ç›®å½•ä¸‹çš„ node_modules ä¸­çš„ï¼‰ã€‚

> å¦‚æœå…¨å±€ä¸­æ²¡æœ‰ä¾èµ–ï¼Œè€Œå­é¡¹ç›®ä¸­æœ‰ç›¸åŒçš„ä¾èµ–ï¼Œä½ ä¹Ÿä¸ç”¨æ‹…å¿ƒï¼Œpnpmä¹Ÿä¼šè‡ªåŠ¨ä¼˜åŒ–å¤„ç†ï¼Œé€šè¿‡è½¯è¿æ¥çš„æ–¹å¼å®‰è£…ä¸€æ¬¡å°±å¯ä»¥ï¼Œå¯ä»¥å®ç°æœ€å°åŒ–å®‰è£…äº§ç‰©ï¼Œéå¸¸çš„å¥½ç”¨ğŸ˜~

```bash
pnpm i vue@^2.6.11 dayjs -Dw
```

- `pnpm i` ä¸ `pnpm add` åŠŸèƒ½æ˜¯ä¸€æ ·çš„
- `-D`ï¼šä½œä¸ºå¼€å‘ä¾èµ–ä½¿ç”¨
- `-w`ï¼šè¡¨ç¤ºæŠŠåŒ…å®‰è£…åœ¨ root ä¸‹ï¼Œè¯¥åŒ…ä¼šæ”¾ç½®åœ¨ `<root>/node_modules` ä¸‹

#### 2. å•ä¸€å­é¡¹ç›®çš„ä¾èµ–

ä½œä¸ºä¸€ä¸ªå¤šåŒ…é¡¹ç›®ï¼Œè‚¯å®šä¼šå­˜åœ¨æŸä¸ªé¡¹ç›®ç‹¬æœ‰çš„ä¸€äº›ä¾èµ–ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥é’ˆå¯¹æ€§çš„å®‰è£…åˆ°æŒ‡å®šå­ç›®å½•ã€‚

> è¿™é‡Œæˆ‘ä»¬åªéœ€è¦å…³æ³¨ä½¿ç”¨å±‚é¢å³å¯ï¼Œå¯¹äºå¤šä¸ªå­é¡¹ç›®æ˜¯å¦å­˜åœ¨ç›¸åŒçš„ä¾èµ–ï¼Œæ˜¯å¦ä¼šé‡å¤å®‰è£…ï¼Œä½ å®Œå…¨ä¸ç”¨æ‹…å¿ƒï¼Œpnpmä¼šä¼˜é›…çš„å¸®ä½ å¤„ç†å¥½ã€‚ä½ å¯ä»¥è¿™æ ·ç†è§£â€”â€”pnpmä¼šä¼˜å…ˆä¿è¯åªä¸‹è½½ä¸€ä¸ªä¾èµ–ï¼Œå½“ä½ åœ¨å¦ä¸€ä¸ªå­é¡¹ç›®ä¸­ä¹Ÿå®‰è£…äº†åŒæ ·çš„ä¾èµ–æ—¶ï¼Œpnpmä¸ä¼šå†å‚»å‚»çš„å»æœåŠ¡å™¨é‡æ–°ä¸‹è½½ä¸€ä»½ã€‚

```sh
# è¯­æ³•
pnpm add <package-name> --filter <target-package-name>

# æ¯”å¦‚è¦å°†lodashè£…åˆ°componentsä¸‹
# --filter åé¢å¯ä»¥ä¸ºç›®å½•åç§°ä¹Ÿå¯ä»¥ä¸º package.josn çš„ name åç§°
# æ¯”è¾ƒæ¨èçš„åšæ³•æ˜¯æ ¹æ® package.josn çš„ name åç§°è¿›è¡ŒåŒºåˆ«
pnpm add lodash --filter @ah-ailpha/components
```

- `--filter`ï¼šè¿‡æ»¤ï¼Œè¿‡æ»¤å…è®¸æ‚¨å°†å‘½ä»¤é™åˆ¶äºåŒ…çš„ç‰¹å®šå­é›†ï¼Œä¸€èˆ¬ç”¨äº `packages/*` ä¸‹é¢çš„å­é¡¹ç›®ã€‚

å¦‚ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦å®‰è£… `iview` åˆ° `components` å­é¡¹ç›®ä¸­ï¼Œé‚£ä¹ˆï¼Œæ ‡å‡†çš„åšæ³•æ˜¯:

1. å…ˆæŸ¥çœ‹ `packages/components/package.json` ä¸­çš„ `name` å­—æ®µï¼ŒæŠŠå®ƒä½œä¸º `filter` çš„è¿‡æ»¤æ¡ä»¶

    ```js
    // components å­é¡¹ç›®çš„ç›®å½•ç»“æ„
    â”œâ”€â”€ packages           // å­é¡¹ç›®ç›®å½•
      â”œâ”€â”€ components       // UIåŸºç¡€ç»„ä»¶
        â”œâ”€â”€ package.json   // name: @ah-ailpha/components
    ```

2. ç„¶åï¼Œ**åœ¨æ ¹ç›®å½•ä¸‹**æ‰§è¡Œå®‰è£…å‘½ä»¤ï¼Œå¹¶æŒ‡å®š `filter`

    ```sh
    # å®‰è£… iview åˆ° componentså­é¡¹ç›®ä¸­
    pnpm add iview --filter @ah-ailpha/components
    ```

3. æŸ¥çœ‹é¡¹ç›®ä¾èµ–å˜åŒ–

    è¿™ä¸ªæ—¶å€™ä½ åº”è¯¥å¯ä»¥å‘ç° `components` å­é¡¹ç›®çš„ `package.json` æ–‡ä»¶çš„ `dependencies` å±æ€§æ˜¯å˜åŒ–äº†çš„ï¼Œè€Œä¸”åº”å½“åªæœ‰è¿™ä¸ªå­é¡¹ç›®æ˜¯å—å½±å“çš„ã€‚

    > åˆ é™¤ç­‰æ“ä½œå‘½ä»¤ä¿æŒä¸€è‡´ï¼Œé™å®šä½œç”¨åŸŸå³å¯ï¼Œå¦‚ï¼špnpm rm dayjs --filter @ah-ailpha/components

    ```json
    {
      "dependencies": {
        "iview": "^3.5.4"
      }
    }
    ```

#### 3. å­é¡¹ç›®äº’ç›¸ä½œä¸ºä¾èµ–

ä½œä¸º monorepo ç®¡ç†çš„é¡¹ç›®ï¼Œè¿™ä¸€æ­¥çš„åŠŸèƒ½æ‰æ˜¯æœ€ä¸ºæ ¸å¿ƒçš„ã€‚

ä»¥æ ‡å‡†çš„ç»„ä»¶åº“é¡¹ç›®ä¸ºä¾‹ï¼š

1. æˆ‘ä»¬ä¸€èˆ¬ä¼šæŠŠ**ç»„ä»¶ç±»**ä»£ç å•ç‹¬åšä¸ºä¸€ä¸ªå­é¡¹ç›®è¿›è¡Œç®¡ç†
2. **æ–‡æ¡£ç½‘ç«™**ä¹Ÿä¼šä½œä¸ºä¸€ä¸ªå­é¡¹ç›®å•ç‹¬ç®¡ç†
3. **å·¥å…·ç±»**ä¹Ÿä¼šä½œä¸ºä¸€ä¸ªå­é¡¹ç›®å•ç‹¬ç®¡ç†
4. ä»¥åŠå¯èƒ½æ ¹æ®ä¸ªäººä¸šåŠ¡éœ€æ±‚è¿˜æœ‰**å…¶ä»–åŠŸèƒ½åŒ…**ï¼ˆcliç­‰ç­‰ï¼‰

ä½†æ˜¯è¿™äº›å­é¡¹ç›®åˆä¸æ˜¯å®Œå…¨ç‹¬ç«‹çš„ï¼Œä»–ä»¬ä¹‹é—´å­˜åœ¨ç€ä¸€äº›ç›¸äº’ä¾èµ–å…³ç³»ï¼Œå¦‚ï¼š

- ç»„ä»¶ä»£ç ä¼šä¾èµ–äºå·¥å…·ç±»çš„ä¸€äº›æ–¹æ³•
- æ–‡æ¡£ç½‘ç«™ä¼šä¾èµ–äºç»„ä»¶å’Œå·¥å…·ç±»ï¼ˆæˆ‘çš„UIæ–‡æ¡£ç½‘ç«™è‚¯å®šç”¨çš„æ˜¯æˆ‘è‡ªå·±çš„UIç»„ä»¶ğŸ˜„ï¼‰

æœ€ç»ˆä»–ä»¬éƒ½ä¼šä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„æ¨¡å—æä¾›ç»™ç”¨æˆ·ï¼Œå› æ­¤ï¼Œä»ä½¿ç”¨è€…çš„è§’åº¦è€ƒè™‘ï¼Œæˆ‘ä»¬åº”è¯¥ä¹Ÿè¦ä¿æŒè¿™ç§ä½¿ç”¨æ–¹å¼â€”â€”npmå®‰è£…åŒ…çš„å½¢å¼ï¼ˆ`import utils from '@an-ailpha/utils'
`ï¼‰ã€‚

é‚£ä¹ˆï¼Œå½“æˆ‘æŠŠå…¶ä¸­ä¸€ä¸ªå­é¡¹ç›®ä½œä¸ºå¦ä¸€ä¸ªé¡¹ç›®çš„ä¾èµ–æ—¶ï¼Œå¦‚ä½•å®ç°æˆ‘åœ¨æœ¬åœ°è°ƒè¯•å¼€å‘çš„æ—¶å€™ï¼Œèƒ½å¤Ÿåšåˆ°ç±»ä¼¼å®‰è£…npmè¿œç¨‹åŒ…ä¸€æ ·ä½¿ç”¨å‘¢ï¼ˆè€Œä¸æ˜¯é€šè¿‡è·¯å¾„å¼•ç”¨å»ä½¿ç”¨ï¼Œè¿™æ ·åšæ—¢ä¸ä¼˜é›…ä¹Ÿä¸æ–¹ä¾¿ï¼Œå½“æˆ‘ä»¬å‘å¸ƒä¹‹åï¼Œè·¯å¾„å¼•ç”¨å°±ä¼šå¤±æ•ˆï¼‰ï¼Ÿä»¥åŠå¦‚ä½•ä¿è¯æˆ‘æ‰€å¼•ç”¨çš„ä¾èµ–éƒ½æ˜¯æœ€æ–°çš„ã€å®æ—¶çš„å‘¢ï¼Ÿå› ä¸ºæˆ‘ä¸å¯èƒ½æ²¡è°ƒæ•´ä¸€ç‚¹ä»£ç å°±é‡æ–°å‘ä¸ª`npm`åŒ…ï¼Œç„¶åå­é¡¹ç›®å†é‡æ–°ä¸‹è½½ä¸€éï¼Œä»¥è¿™ç§æ–¹å¼éªŒè¯å§ã€‚

ä»¤äººé«˜å…´çš„æ˜¯ï¼Œpnpm çš„ **workspace** å·¥ä½œç©ºé—´çš„åŠŸèƒ½å¯ä»¥å®Œå…¨æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼Œå®ƒå¯ä»¥å®ç°è¿™ç§æ•ˆæœã€‚

å¦‚ï¼šå­é¡¹ç›®`packages/components`éœ€è¦ä½¿ç”¨`packages/utils`å­é¡¹ç›®ä½œä¸ºé¡¹ç›®ä¾èµ–ï¼Œæˆ‘ä»¬ç›´æ¥æŒ‰ç…§ `npm` å®‰è£…ä¾èµ–çš„é€»è¾‘ä½¿ç”¨å³å¯

ç›®å½•ç»“æ„ï¼š

```js
â”œâ”€â”€ packages           // å­é¡¹ç›®ç›®å½•
  â”œâ”€â”€ components       // UIåŸºç¡€ç»„ä»¶
    â”œâ”€â”€ package.json   // name: @ah-ailpha/components
  â”œâ”€â”€ utils            // å·¥å…·ç±»
    â”œâ”€â”€ package.json   // name: @ah-ailpha/utils
```

1. æŸ¥çœ‹ `packages/utils/package.json`ã€`packages/components/package.json` ä¸­çš„ `name` å­—æ®µ

2. ç„¶åï¼Œ**åœ¨æ ¹ç›®å½•ä¸‹**æ‰§è¡Œå®‰è£…å‘½ä»¤ï¼Œå¹¶æŒ‡å®š `filter`

    ```sh
    # æŠŠå­æ¨¡å— `packages/utils` å½“æˆä¾èµ–å®‰è£…åˆ° `packages/components`
    pnpm add @ah-ailpha/utils --filter @ah-ailpha/components
    ```

3. æŸ¥çœ‹ä¾èµ–å˜åŒ–

    è¿™ä¸ªæ—¶å€™ä½ åº”è¯¥å¯ä»¥å‘ç° `components` å­é¡¹ç›®çš„ `package.json` æ–‡ä»¶çš„ `dependencies` å±æ€§æ˜¯å˜åŒ–äº†çš„:

    ```json
    {
      "dependencies": {
        "@ah-ailpha/utils": "workspace:^1.0.0",
        "iview": "^3.5.4"
      }
    }
    ```

   - `"@ah-ailpha/utils": "workspace:^1.0.0"`ï¼Œè¿™æ˜¯`pnpm`çš„`workspace`å·¥ä½œç©ºé—´åè®®å†™æ³•

    > å®ƒå®ç°çš„æ•ˆæœæ˜¯ï¼šutilså­é¡¹ç›®ä¸­æ›´æ–°åçš„æœ€æ–°ä»£ç ï¼Œå½“ä½ åœ¨ components ä¸­ä½¿ç”¨æ—¶ä¹Ÿæ˜¯æœ€æ–°çš„ï¼Œä½ å¯ä»¥ç†è§£ä¸ºä»–ä¿©å·²ç»å½¢æˆäº†ç»‘å®šå…³ç³»

   - éœ€è¦æŒ‡å‡ºçš„æ˜¯ï¼Œå½“ä½ åœ¨æ‰§è¡Œå‘å¸ƒæ“ä½œä¹‹åï¼ŒnpmåŒ…ä¸­çš„ç‰ˆæœ¬ä¼šè¢«è‡ªåŠ¨æ›´æ–°ä¸ºæŒ‡å®šç›®å½•ä¸‹`package.json` çš„ `version`å€¼

    > å¦‚æœï¼Œæ­¤æ—¶`utils/package.json`ä¸­çš„`version`å€¼ä¸º`1.1.0`ï¼Œé‚£ä¹ˆä¸Šé¢çš„`"@ah-ailpha/utils": "workspace:^1.0.0"`ä¼šè‡ªåŠ¨æ›´æ–°ä¸º`"@ah-ailpha/utils": "^1.1.0"`

### ç®€å•è¯´è¯´npmç‰ˆæœ¬è§„èŒƒ

ä»ä¸Šé¢çš„å®‰è£…ä¾èµ–ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°npmä¸­çš„ä¸€äº›ç‰ˆæœ¬è§„åˆ™ï¼š`^`ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬æ¯”è¾ƒå¸¸è§çš„ï¼Œnpmçš„é»˜è®¤æŒ‰ç…§é€»è¾‘æ˜¯æŒ‰ç…§è¿™ä¸ªè§„åˆ™æ‰§è¡Œçš„ï¼Œå…¶ä»–å‰ç¼€è¿˜æœ‰ï¼š`~`ã€`*`ï¼Œé‚£ä¹ˆå®ƒä»¬æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿä½œç”¨åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ

- æˆ‘ä»¬å…ˆäº†è§£ä¸‹ç‰ˆæœ¬æ ¼å¼ï¼š

  **ä¸»ç‰ˆæœ¬å·.æ¬¡ç‰ˆæœ¬å·.ä¿®è®¢å·**

- ç‰ˆæœ¬å·é€’å¢è§„åˆ™å¦‚ä¸‹ï¼š

  1. ä¸»ç‰ˆæœ¬å·ï¼šå½“ä½ åšäº†ä¸å…¼å®¹çš„ API ä¿®æ”¹ï¼Œ
  2. æ¬¡ç‰ˆæœ¬å·ï¼šå½“ä½ åšäº†å‘ä¸‹å…¼å®¹çš„åŠŸèƒ½æ€§æ–°å¢ï¼Œ
  3. ä¿®è®¢å·ï¼šå½“ä½ åšäº†å‘ä¸‹å…¼å®¹çš„é—®é¢˜ä¿®æ­£ã€‚
  
  > å…ˆè¡Œç‰ˆæœ¬å·åŠç‰ˆæœ¬ç¼–è¯‘ä¿¡æ¯å¯ä»¥åŠ åˆ°â€œä¸»ç‰ˆæœ¬å·.æ¬¡ç‰ˆæœ¬å·.ä¿®è®¢å·â€çš„åé¢ï¼Œä½œä¸ºå»¶ä¼¸ã€‚
  >
  > æ¯”å¦‚ï¼Œæˆ‘ä»¬ç»å¸¸åœ¨å¼€æºé¡¹ç›®ä¸­è§åˆ°çš„ï¼šalphaã€beta ã€rc

è¿™é‡Œä¸å†åšè¿‡å¤šèµ˜è¿°ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥çœ‹è¿™é‡Œ [è¯­ä¹‰åŒ–ç‰ˆæœ¬å·æ ‡å‡†](https://semver.org/lang/zh-CN/)

- npm çš„ç‰ˆæœ¬åŒ¹é…ç­–ç•¥

  - `^1.0.1`ï¼šåªè¦ä¸»ç‰ˆæœ¬ä¸€è‡´éƒ½åŒ¹é…ï¼ˆ1.xï¼‰ï¼Œå¦‚ï¼š`1`ã€`1.x`
  - `~1.0.1`ï¼šåªè¦ä¸»ç‰ˆæœ¬å’Œæ¬¡ç‰ˆæœ¬ä¸€è‡´éƒ½åŒ¹é…ï¼ˆ1.1.xï¼‰ï¼Œå¦‚ï¼š`1.1`ã€`1.1.x`
  - `*` ï¼šå…¨åŒ¹é…ï¼Œä¸å—ç‰ˆæœ¬å·å½±å“ï¼Œå¯ä»¥å‘½ä¸­ä¸€åˆ‡æ–°å‘å¸ƒçš„ç‰ˆæœ¬å·

ä¸è¿‡ï¼Œå°±é’ˆå¯¹æˆ‘ä»¬è¿™ä¸ªé¡¹ç›®æ¥è¯´ï¼Œå®ƒçš„`workspace`åè®®ä¹Ÿæ˜¯ç¬¦åˆnpmç‰ˆæœ¬è§„èŒƒçš„ï¼Œæˆ‘ä»¬å­é¡¹ç›®å†…çš„å¼•ç”¨ä¹Ÿå¯ä»¥é‡‡ç”¨å¯¹åº”çš„åŒ¹é…ç­–ç•¥ã€‚

ä½†æ˜¯ï¼Œä¸åŒäºç”¨æˆ·ä½¿ç”¨ï¼Œæˆ‘ä»¬å„å­é¡¹ç›®ä¸ºäº†æ–¹ä¾¿ä¸å—ç‰ˆæœ¬å½±å“ï¼Œä»è€Œåšåˆ°åŒ¹é…ä¸€è‡´ï¼Œä¸€èˆ¬é‡‡ç”¨`*`å…¨åŒ¹é…ç­–ç•¥ï¼Œä»å¼€å‘è°ƒè¯•çš„è§’åº¦è€ƒè™‘ï¼Œå„å­é¡¹ç›®é—´çš„ä¾èµ–å¼•ç”¨åº”è¯¥éƒ½æ˜¯æœ€æ–°çš„ä»£ç ï¼Œè¿™ä¸€ç‚¹æ˜¯éœ€è¦æ¸…æ¥šçš„ã€‚

ä½ å¯ä»¥è¿™æ ·å®‰è£…ä½¿ç”¨ï¼š

 ```sh
 pnpm add @ah-ailpha/utils@* --filter @ah-ailpha/components
 ```

 ç„¶åï¼Œä¾èµ–ä¼šå˜æˆè¿™æ ·ï¼š

 ```json
 {
   "dependencies": {
     "@ah-ailpha/utils": "workspace:*",
   }
 }
 ```

 ç›®å‰ï¼Œè¿™ç§å†™æ³•ä¹Ÿæ˜¯å­é¡¹ç›®é—´ä¾èµ–å¼•ç”¨æ¯”è¾ƒæ¨èçš„ï¼Œä¾èµ–å…³ç³»ä¸å—ç‰ˆæœ¬å½±å“ï¼Œå¯ä»¥åšåˆ°ç›¸å¯¹ç»Ÿä¸€ã€‚

### å°ç»“

1. æ‰€æœ‰çš„å‘½ä»¤æ“ä½œéƒ½æ˜¯åœ¨ä¸»ç›®å½•ä¸‹è¿›è¡Œçš„ï¼Œç”¨æˆ·è§†è§’åº”å§‹ç»ˆåœ¨ä¸»ç›®å½•ä¸‹æ‰å¯¹
2. å„å­é¡¹ç›®çš„`package.json`çš„`name`åº”è¯¥ç¬¦åˆè¯¥è§„èŒƒâ€”â€”`@ah-ailpha/components`
   - è¿™æ ·åšçš„å¥½å¤„ä¹‹ä¸€æ˜¯å¯ä»¥å¸®æˆ‘ä»¬ç»Ÿä¸€ä½œç”¨åŸŸå‰ç¼€
   - å…¶æ¬¡ï¼Œå½“æˆ‘ä»¬å‘å¸ƒnpmåŒ…æ—¶ï¼Œ`@ah-ailpha`ä¼šä½œä¸ºnpmçš„ä¸€ä¸ªç»„ç»‡åŸŸä½¿ç”¨
3. å­é¡¹ç›®å†…éƒ¨å¼•ç”¨ä½¿ç”¨npm `*`å…¨åŒ¹é…ç­–ç•¥

## monorepoé¡¹ç›®çš„å·¥ç¨‹åŒ–æ­å»º

ä¸€ä¸ªåŸºæœ¬æ ‡å‡†å°±æ˜¯ï¼šæ‰€æœ‰çš„è§„èŒƒé…ç½®éƒ½åº”ä»¥ä¸»ç›®å½•ä¸ºèµ·ç‚¹å¼€å§‹ã€‚

ç›®å‰å·¥ç¨‹è§„èŒƒæœ‰ï¼š`eslint`ã€`prettier`ã€`markdownlint`ã€`commitlint`ã€`typescript`

### ä¸ºä»€ä¹ˆåœ¨vue2çš„é¡¹ç›®ä¸­å¼•å…¥äº†typescript

æˆ‘ä»¬éƒ½çŸ¥é“`vue2`ç‰ˆæœ¬å¯¹`ts`çš„æ”¯æŒå¾ˆä¸€èˆ¬ï¼Œç›¸å…³ç”Ÿæ€åº“å¤§å¤šä¹Ÿéƒ½æ˜¯`js`å¼€å‘çš„ï¼ŒåŒ…æ‹¬`iview`ä¹Ÿæ˜¯ä½¿ç”¨`js`å¼€å‘çš„ï¼›é‚£ä¹ˆï¼Œæˆ‘è¿™é‡Œä¸ºä»€ä¹ˆä¾æ—§é‡‡ç”¨äº†å¯¹`ts`çš„æ”¯æŒå‘¢ï¼Ÿ

1. æœ€æ ¸å¿ƒçš„ä¸€ç‚¹ï¼Œå½“ä¸‹å‰ç«¯ç”Ÿæ€`TS`æ­£å¤§æ­¥å‘å‰ï¼Œæˆ‘ä¹‹å‰ä¹Ÿä¸€ç›´åœ¨ä½¿ç”¨`TS`å¼€å‘ï¼Œç°åœ¨ä¸èƒ½å› ä¸º`vue2`è€Œå°±æ”¾å¼ƒäº†ï¼Œè¿˜æ˜¯åº”è¯¥ä»¥ç§¯ææ‹¥æŠ±çš„å¿ƒæ€
2. æœ¬é¡¹ç›®æ¶æ„æ”¯æŒå­é¡¹ç›®é‡‡ç”¨ä¸åŒçš„è§„èŒƒç­–ç•¥ï¼Œä»¥`vue2`ä¸ºä¸»çš„`components`å­é¡¹ç›®å®Œå…¨å¯ä»¥åœ¨æœ¬ç›®å½•ä¸‹é…ç½®ä¸€å¥—è‡ªå·±çš„é¡¹ç›®è§„åˆ™ï¼Œè¿›è€Œè¦†ç›–ä¸»é¡¹ç›®é…ç½®ï¼Œé‚£ä¹ˆï¼Œç°åœ¨å¯ä»¥åšåˆ°çš„æ˜¯ï¼Œ
3. æœ¬é¡¹ç›®ä¸æ˜¯å•ä¸€çš„`vue2`ç»„ä»¶é¡¹ç›®ï¼Œä»–è¿˜åŒ…æ‹¬ `utils`ç­‰å…¶ä»–å­é¡¹ç›®ï¼Œæ˜¯ä¸€ä¸ªå®Œå–„çš„å‰ç«¯ç»„ä»¶åŒ–é¡¹ç›®ï¼Œè¿™äº›éƒ½éœ€è¦è€ƒè™‘åœ¨å†…

æˆ‘åœ¨å¼€å‘`utils`å­é¡¹ç›®æ—¶é‡‡ç”¨äº†`typescript` + `rollup`çš„å¼€å‘å’Œæ„å»ºæ¨¡å¼ï¼ŒTSå®Œå–„çš„ç±»å‹æ”¯æŒç³»ç»Ÿå¯¹å¼€å‘è¿™ä¸€ç±»å·¥å…·å‡½æ•°åº“ï¼Œæä¾›äº†æå¤§çš„æ–¹ä¾¿ã€‚ç›®å‰è¿™ä¸ªåº“ä¹Ÿå®Œå…¨ä¸å—æŠ€æœ¯æ ˆå½±å“ï¼Œä½ å¯ä»¥åœ¨ä»»ä½•éœ€è¦çš„åœ°æ–¹ä½¿ç”¨ï¼Œå°±ç±»ä¼¼`lodash`é‚£æ ·ï¼Œè€Œä¸”å½“ä½ åœ¨`TS`é¡¹ç›®ä½¿ç”¨æ—¶åˆèƒ½è·å¾—å®Œå–„çš„ç±»å‹æç¤ºï¼Œå²‚ä¸ç¾å“‰~

å¯¹äº`vue2` + `iview`æˆ‘å°±é‡‡ç”¨å®˜æ–¹çš„`js`ç”Ÿæ€å³å¯ï¼Œç›´æ¥å¤ç”¨ç°æˆçš„é¡¹ç›®é…ç½®ï¼Œåœ¨è¿™é‡Œä½ ä¹Ÿå¯ä»¥æŠŠå®ƒå½“æˆä¸€ä¸ªç‹¬ç«‹çš„é¡¹ç›®å»å¼€å‘ï¼Œä¹Ÿæ˜¯å®Œå…¨OKçš„ã€‚

æ›´è¿›ä¸€æ­¥çš„è¯´ï¼Œä»¥åéƒ½æ˜¯ä½¿ç”¨vue3ç”Ÿæ€äº†ï¼Œå…¨é¢æ‹¥æŠ±TSä¸å¯é¿å…ï¼Œå­¦èµ·æ¥~

### å·¥ç¨‹åŒ–è§„èŒƒé…ç½®

é¡»è¦æŒ‡å‡ºçš„æ˜¯**ä¸€å®šè¦æ³¨æ„ç‰ˆæœ¬ä¸€å®šè¦æ³¨æ„ç‰ˆæœ¬ä¸€å®šè¦æ³¨æ„ç‰ˆ**ã€‚

å‰ç«¯çš„å·¥ç¨‹åŒ–é…ç½®æˆ‘åœ¨å¦ä¸€ç¯‡vue3çš„ç›¸å…³æ–‡ç« ä¸­ä¹Ÿä»‹ç»è¿‡ï¼Œéƒ½æ˜¯å¤§åŒå°å¼‚ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥çœ‹çœ‹[vite + vue3 + setup + pinia + ts é¡¹ç›®å®æˆ˜](https://juejin.cn/post/7041188884864040991)

å”¯ä¸€ä¸åŒçš„æ˜¯ï¼Œæœ¬é¡¹ç›®å¢åŠ äº†å¯¹Markdownç±»å‹æ–‡ä»¶çš„æ ¼å¼åŒ–å¤„ç†ï¼ˆ`.md`ï¼‰ï¼Œè¿™é‡Œä¸»è¦ä½¿ç”¨çš„æ˜¯ [markdownlint-cli](https://www.npmjs.com/package/markdownlint-cli)ã€‚

ä¸ºä»€ä¹ˆå¢åŠ äº†è¿™ä¸€é¡¹è§„åˆ™ï¼Œè¿™å’Œæˆ‘ä»¬çš„é¡¹ç›®éœ€æ±‚æœ‰å¾ˆå¤§çš„å…³è”ï¼Œå‰é¢æˆ‘ä»¬è¯´è¿‡æˆ‘ä»¬ä¼šæ­å»ºä¸€ä¸ªå®Œå–„çš„æ–‡æ¡£ç½‘ç«™ç³»ç»Ÿï¼Œç»„ä»¶åº“ç¦»ä¸å¼€è¯¦ç»†çš„æ–‡æ¡£è¯´æ˜ï¼ŒMarkdownæ˜¯æˆ‘ä»¬çš„ä¸äºŒä¹‹é€‰ï¼Œä¹‹åé¡¹ç›®ä¸­ä¼šå­˜åœ¨å¤§é‡çš„`.md`æ–‡ä»¶ï¼Œæ­¤æ—¶ï¼Œä¿æŒä¸€ä¸ªç»Ÿä¸€è§„èŒƒçš„æ ¼å¼åŒ–è§„åˆ™æ˜¯ååˆ†å¿…è¦çš„ã€‚

> è¿™æ–¹é¢çš„é…ç½®æˆ‘æ¨èå­¦ä¹ [element-plus](https://github.com/element-plus/element-plus)çš„ç›¸å…³å®ç°ï¼Œååˆ†å€¼å¾—å­¦ä¹ ã€‚

#### å‰äººæ ½æ ‘æˆ‘ä¹˜å‡‰ğŸ˜¬

åœ¨é…ç½® `eslint`ã€`prettier`ç»å¸¸è¸©çš„å‘å°±æ˜¯å› ä¸ºç‰ˆæœ¬é—®é¢˜ï¼Œè¿™é‡Œå¹¶ä¸æ¨èä»é›¶å¼€å§‹ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥æ‰¾ä¸€äº›å’Œè‡ªå·±é£æ ¼å€¾å‘æ¯”è¾ƒä¸€è‡´çš„å¼€æºé¡¹ç›®ï¼Œå€Ÿé‰´åˆ«äººé¡¹ç›®ä¸­é…ç½®å¥½çš„ä¾èµ–ï¼Œä½¿ç”¨åˆ°æˆ‘ä»¬è‡ªå·±çš„é¡¹ç›®ä¸­ã€‚

åªæœ‰åœ¨æˆ‘ä»¬æƒ³å®šä¹‰è‡ªå·±çš„ç‰¹æ®Šè§„èŒƒæ—¶ï¼Œè¿™æ—¶æ‰éœ€è¦ç»“åˆå®˜æ–¹æ–‡æ¡£äº†è§£è§„åˆ™é…ç½®çš„å„ç§å‚æ•°ï¼Œä»¥åŠç›¸å…³è§„åˆ™åŒ…çš„ä¸€äº›æ’ä»¶åº“ï¼ŒæŒ‰éœ€å®‰è£…é…ç½®å³å¯ï¼Œè¿™æ ·å¯ä»¥èŠ‚çœå¤§é‡æ—¶é—´æˆæœ¬ï¼Œæ¯•ç«Ÿå¾ˆå¤šå¼€æºé¡¹ç›®éƒ½æ˜¯æå…¶æˆç†Ÿçš„äº†ï¼ˆè¿™é‡Œä¹Ÿéœ€è¦æµ‹è¯•ç‰ˆæœ¬ï¼Œé»˜è®¤å®‰è£…ä¸€èˆ¬éƒ½æ˜¯æœ€æ–°çš„ï¼ŒåŸºäºvue3ç¯å¢ƒçš„ï¼Œå¯ä»¥å‚è€ƒä¸€äº›vue2çš„é¡¹ç›®ï¼‰ã€‚

åœ¨å¼•å…¥TypeScriptæ”¯æŒæ—¶ï¼Œéœ€è¦å®‰è£…`@typescript-eslint/parser`ä¾èµ–ï¼Œè¿™æ—¶`eslint`çš„é…ç½®æ˜¯æœ‰æ‰€è°ƒæ•´çš„ï¼š

```diff
- "parser": "@typescript-eslint/parser",
+ "parser": "vue-eslint-parser",
  "parserOptions": {
+     "parser": "@typescript-eslint/parser",
      "sourceType": "module"
  }
```

è‡ªå®šä¹‰è§£æå™¨ `@typescript-eslint/parser` éœ€è¦ `vue-eslint-parser`æ’ä»¶å…ˆè§£æ `.vue` æ–‡ä»¶ï¼Œè¿™æ˜¯éœ€è¦æ³¨æ„çš„ä¸€ç‚¹ã€‚

#### é¡¹ç›®è§„èŒƒçš„å‘½ä»¤é…ç½®

```json
"scripts": {
  // çº¦æŸåŒ…ç®¡ç†å·¥å…·ä¸º pnpm
  "preinstall": "npx only-allow pnpm", 
  // é…åˆgit commitçš„æäº¤è§„èŒƒ commitlint
  "prepare": "husky install", 
  // eslint lintå‘Šè­¦ä¿¡æ¯æŸ¥çœ‹ä¸åˆè§„èŒƒçš„é”™è¯¯
  "lint": "eslint . --ext .vue,.js,.ts,.jsx,.tsx,.json --max-warnings 0", 
  // eslint fix ç›´æ¥ä¿®å¤ä¸åˆè§„èŒƒçš„ä»£ç 
  "lint:fix": "eslint --fix . --ext .vue,.js,.ts,.jsx,.tsx,.json", 
  // å·¥å…·ç±»çš„å•ç‹¬lint
  "lint:utils": "eslint --fix \"./packages/utils/**\" --ext .js,.ts,.json", 
  // Markdown æ–‡ä»¶ lintï¼ˆpackagesç›®å½•ä¸‹ï¼‰
  "markdownlint": "markdownlint \"./packages/**/*.md\"",
  // Markdown æ–‡ä»¶ lint fixï¼ˆæ•´ä¸ªé¡¹ç›®ï¼‰
  "markdownlint:fix": "markdownlint --fix \"**/*.md\"",
}
```

é…åˆvscodeä¿å­˜æ—¶è‡ªåŠ¨æ£€æŸ¥fix

```json
{
  "editor.formatOnSave": true, //æ¯æ¬¡ä¿å­˜çš„æ—¶å€™è‡ªåŠ¨æ ¼å¼åŒ–
  "eslint.quiet": true, // å¿½ç•¥ warning çš„é”™è¯¯
  "editor.codeActionsOnSave": {
    // ä¿å­˜æ—¶ä½¿ç”¨ ESLint ä¿®å¤å¯ä¿®å¤é”™è¯¯
    "source.fixAll.eslint": true
  },
  // ä»¥ eslint æ ¼å¼åŒ–ï¼ˆæ¨èä½¿ç”¨ä¸‹é¢çš„æ–¹å¼ï¼‰
  // "[vue]": {
  //   "editor.defaultFormatter": "dbaeumer.vscode-eslint"
  // },

  // ä»¥ prettier æ ¼å¼åŒ–ï¼Œé…åˆeslintä¸€èµ·é£Ÿç”¨æ›´ä½³
  "[vue]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  },
  "[javascriptreact]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  },
  "[typescript]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  },
}
```

ä¸ºäº†ä¸ä½¿ `eslint`å’Œ`prettier`çš„è§„åˆ™å‘ç”Ÿå†²çªï¼Œä½ åº”è¯¥åœ¨`eslint`ä¸­è¿™æ ·é…ç½®ï¼Œä»¥ä¿è¯å¯ä»¥åˆå¹¶é…ç½®ï¼Œå¹¶ä½¿ç”¨ `prettier`æ ¼å¼åŒ–

```js
{
  extends: [
    // 'plugin:vue/recommended',
    'plugin:prettier/recommended',
    'prettier',
    // 'plugin:@typescript-eslint/recommended',
  ],
  rules: {
    'prettier/prettier': 'error',
  }
}
```

é…åˆgitï¼ˆå‚è§ `.husky`ç›®å½•ï¼‰

- commit-msgï¼šæäº¤ä¿¡æ¯è§„èŒƒéªŒè¯
- pre-commitï¼šæäº¤å‰æ‰§è¡Œä»£ç æ ¼å¼åŒ–éªŒè¯ç­‰å…¶ä»–å·¥ä½œ

é…åˆpre-commitå·¥ä½œçš„lint-stagedç›¸å…³é…ç½®ï¼š

```json
{
  "*.{vue,js,ts,jsx,tsx,json}": [
    "eslint --fix",
    "prettier --write"
  ],
  "*.md": [
    "markdownlint --fix",
    "prettier --write"
  ]
}
```

`eslint`ã€`prettier`ã€`commitlint`è¿™äº›éƒ½æ˜¯å¾ˆå¸¸è§„çš„é…ç½®ï¼Œè¿™é‡Œå°±ä¸åœ¨è¿‡å¤šå™è¿°äº†ï¼Œä»£ç æ”¾åœ¨ä¸‹é¢äº†ï¼Œç›´æ¥çœ‹ä»£ç ~ï¼Œ

## åŒ…æ„å»º

åŒ…æ„å»ºçš„åŸºæœ¬æ€è·¯ä¾ç„¶æ˜¯æŒ‰ç…§å½“å‰æˆç†Ÿæ–¹æ¡ˆè¿›è¡Œï¼Œ`vue2`ç”Ÿæ€çš„ç»„ä»¶ç±»ä»£ç ä¼˜å…ˆä½¿ç”¨ `Webpack`è¿›è¡Œæ„å»ºæ‰“åŒ…ï¼Œå¹¶ä¸”è¦æ”¯æŒ`ES Module`è¿™ç§å¼•å…¥æ–¹å¼ï¼Œæ–¹ä¾¿ä¸ºä¹‹åçš„æŒ‰éœ€å¼•å…¥åšé“ºå«ï¼Œå½“ç„¶ï¼Œä¸ºäº†å…œåº•çš„å…¼å®¹ï¼Œä¹Ÿè¦æ”¯æŒ `umd` è¿™ç§æ–¹å¼ã€‚

æˆ‘åœ¨æ­å»ºæœ¬é¡¹ç›®çš„`vue2` + `iview`çš„ç»„ä»¶åº“æ—¶ï¼Œç¢äºç‰ˆæœ¬çš„å½±å“ï¼Œå­é¡¹ç›®ç›¸å…³å…¨éƒ¨é‡‡ç”¨ `iview`é¡¹ç›®ä¸­çš„æ„å»ºé…ç½®è¿›è¡Œæ‰“åŒ…ï¼Œè¿™æ ·å¯ä»¥é¿å…å¤§é‡`Webpack`é…ç½®æ—¶çš„ç‰ˆæœ¬é—®é¢˜ã€‚

è€Œå¯¹äº `utils`è¿™ç§ä¸å—`vue2`å½±å“çš„ç‹¬ç«‹åº“ï¼Œåˆ™ä¼˜å…ˆé‡‡ç”¨`TypeScript` + `Rollup`è¿™ç§æ›´æ–¹ä¾¿åº“æ¨¡å¼çš„æ–¹å¼è¿›è¡Œæ„å»ºï¼Œä½¿å¾—å…¶èƒ½å¤Ÿå¯¹ä¸Šä¸‹åšåˆ°å¾ˆå¥½çš„æ”¯æŒï¼ˆ`js`ã€`ts`ï¼‰ã€‚

### ç»Ÿä¸€å‡ºå…¥å£

æ¯ä¸ªç»„ä»¶éƒ½åº”è¯¥ä»¥ `index.js` ä½œä¸ºå‡ºå…¥å£ï¼Œè€Œæ•´ä¸ªç»„ä»¶åº“ä¸‹çš„`index.js`åº”è¯¥æ˜¯æ‰€æœ‰å…¥å£çš„é›†åˆã€‚

è¿™æ ·åšçš„å¥½å¤„ï¼Œå…¶ä¸€ï¼Œç›®å½•ç»“æ„æ¸…æ™°æ–¹ä¾¿ç»´æŠ¤ï¼Œå…¶äºŒæ–¹ä¾¿å¼•ç”¨æ³¨å†Œç»Ÿä¸€ç®¡ç†ã€‚

```js
â”œâ”€â”€ packages                        // packageså·¥ä½œç›®å½•
      â”œâ”€â”€ components                // componentsç»„ä»¶ç›®å½•
        â”œâ”€â”€ index.js                // componentsç»„ä»¶ç»Ÿä¸€å‡ºå…¥å£
        â”œâ”€â”€ src                     // componentsç»„ä»¶æºç ç›®å½•
          â”œâ”€â”€ select                // selectç»„ä»¶çš„å¼€å‘ç›®å½•
              â”œâ”€â”€ src               // ç»„ä»¶æºç 
                  â”œâ”€â”€ style         // æ ·å¼ç›¸å…³
                  â”œâ”€â”€ index.vue     // ç»„ä»¶æ–‡ä»¶
                  â”œâ”€â”€ props.js      // propsç›¸å…³å®šä¹‰çš„å£°æ˜
                  â”œâ”€â”€ const.js      // å¸¸é‡
              â”œâ”€â”€ index.js          // ç»„ä»¶å”¯ä¸€å‡ºå…¥å£
```

`select`ç»„ä»¶çš„`index.vue`å¦‚ä¸‹ï¼š

```vue
<script>
export default {
  name: 'AhSelect',
}
</script>
```

`select`ç»„ä»¶çš„`index.js`å¦‚ä¸‹ï¼š

```js
import Select from './src/index.vue'

Select.install = function (Vue) {
  Vue.component(Select.name, Select)
}

export default Select
```

`components/index.js`å¦‚ä¸‹ï¼š

```js
import AhButton from './src/button/index'
import AhSelect from './src/select/index'

const components = {
  AhButton,
  AhSelect,
}

const install = function (Vue) {
  if (install.installed) return

  Object.keys(components).forEach(key => {
    Vue.component(key, components[key])
  })
}

// auto install
if (typeof window !== 'undefined' && window.Vue) {
  install(window.Vue)
}

const API = {
  ...components,
  install,
}

export default API
```

utilsçš„ç›®å½•ç»“æ„ï¼š

```js
â”œâ”€â”€ packages              // packageså·¥ä½œç›®å½•
  â”œâ”€â”€ utils               // utilsçš„å¼€å‘ç›®å½•
      â”œâ”€â”€ src             // utilsæºç ç›®å½•
          â”œâ”€â”€ dom         // domç›¸å…³å·¥å…·ç›®å½•
          â”œâ”€â”€ object      // objectç›¸å…³å·¥å…·ç›®å½•
          â”œâ”€â”€ index.ts    // ç»Ÿä¸€å‡ºå…¥å£
```

`src/dom/getScrollTop.ts`ä»£ç å¦‚ä¸‹ï¼š

```ts
/**
 * @desc è®¾ç½®æ»šåŠ¨æ¡è·é¡¶éƒ¨çš„è·ç¦»
 * @param {Number} value
 */
export function setScrollTop(value: number): number {
  window.scrollTo(0, value)
  return value
}
```

`src/index.ts`ä»£ç å¦‚ä¸‹ï¼š

```ts
// dom
export * from './dom/setScrollTop'
export * from './dom/getOffset'
// object
export * from './object/deepClone'
export * from './object/isEmptyObject'
```

### æ„å»ºé…ç½®

åº”è¯¥éµå¾ªç›¸å¯¹çš„ç»Ÿä¸€ï¼Œå³ï¼Œæˆ‘ä»¬åº”è¯¥åœ¨ä¸»é¡¹ç›®ä¸‹ç»Ÿä¸€ç»´æŠ¤ä¸€ä»½ç»Ÿä¸€çš„åŸºç¡€é…ç½®æ–‡ä»¶ï¼Œæ¯ä¸ªå­é¡¹ç›®å†æ ¹æ®å…¶`package.json`åšéƒ¨åˆ†å‚æ•°çš„ç»†å¾®è°ƒæ•´ï¼Œå¦‚ï¼šåŒ…åç§°ã€ç‰ˆæœ¬ç­‰ã€‚

åœ¨æ ¹ç›®å½•ä¸‹åˆ›å»º `build`ç›®å½•ï¼Œç”¨äºæ”¾ç½®ä¸€äº›å·¥ç¨‹é…ç½®ç›¸å…³çš„æ–‡ä»¶,ï¼Œå¦‚ï¼š`webpack.base.config.js`ã€‚

å­é¡¹ç›®`packages/components`ä¸­é€šè¿‡å¼•å…¥è¯¥é…ç½®ï¼Œå†ç»“åˆ `webpack-merge`å®Œæˆå¯¹é…ç½®çš„åˆå¹¶

```js
// webpack.config.js
const webpackBaseConfig = require('../../build/webpack.base.config')

module.exports = merge(webpackBaseConfig, {
  mode: 'production',
  // ...
})
```

åœ¨`package.json`ä¸­é…ç½®å¦‚ä¸‹è„šæœ¬ï¼š

```json
"scripts": {
  "clean": "rimraf dist",
  "build": "pnpm run clean && webpack --config webpack.config.js"
}
```

éœ€è¦æŒ‡å‡ºçš„æ˜¯ä¸Šé¢çš„è„šæœ¬ä¼šåœ¨ä¸»ç›®å½•ä¸‹é€šè¿‡ç‰ˆæœ¬æ§åˆ¶ç”±pnpmç»Ÿä¸€æ‰§è¡Œï¼ˆå½“ç„¶ä½ ä¹Ÿå¯ä»¥å•ç‹¬æ‰§è¡Œï¼Œä½†ä¸æ¨èï¼‰ã€‚

åœ¨ä¸»ç›®å½•ä¸‹ä½ å¯ä»¥è¿™æ ·æ‰§è¡Œä»¥ä¸Šçš„å‘½ä»¤ï¼š

```sh
# ä½¿ç”¨ --filter
pnpm run --filter ./packages/components build # è·¯å¾„
pnpm run --filter @ah-ailpha/components build # åŒ…åç§°
# ä½¿ç”¨ -C
pnpm run -C ./packages/components build
```

åœ¨æµ‹è¯•æ—¶ä½ å¯ä»¥é€‰æ‹©è¿™æ ·ä½¿ç”¨ï¼Œä½†åœ¨å®é™…å¼€å‘å½“ä¸­æˆ‘ä»¬éƒ½æ˜¯é€šè¿‡è„šæœ¬ä¸€é”®æ‰“åŒ…ã€å‘åŒ…ï¼Œç»Ÿä¸€å¤„ç†çš„ï¼Œå®Œæ•´çš„å†™æ³•å¦‚ä¸‹ï¼š

```json
"scripts": {
  "clean": "pnpm run --filter \"./packages/**\" -r --parallel clean",
  "build:packages": "pnpm run --filter \"./packages/**\" -r --parallel build",
}
```

è¿™é‡Œæ–°å¢äº†ä¸¤ä¸ªå‘½ä»¤è¡Œå‚æ•°ï¼Œç®€å•ä»‹ç»ä¸‹ï¼š

- `-r`ï¼šå¯¹æ‰€æœ‰å­é¡¹ç›®æ‰§è¡Œå‘½ä»¤ï¼ˆå¦‚æ‰§è¡Œæ¯ä¸ªå­é¡¹ç›®çš„ clean å‘½ä»¤ `pnpm run -r clean`ï¼‰
- `--parallel`ï¼šå¿½ç•¥å¹¶å‘ï¼Œç«‹å³åœ¨æ‰€æœ‰åŒ¹é…çš„è½¯ä»¶åŒ…ä¸­è¿è¡Œä¸€ä¸ªç»™å®šçš„è„šæœ¬ï¼Œç”¨äºåœ¨è®¸å¤š packages ä¸Šé•¿æ—¶é—´è¿è¡Œçš„è¿›ç¨‹ï¼Œä¾‹å¦‚å†—é•¿çš„æ„å»ºè¿›ç¨‹ã€‚

utilså·¥å…·ç±»çš„é…ç½®ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œä¸è¿‡å¤šæè¿°äº†ï¼Œå¯ä»¥ç›´æ¥çœ‹ä»“åº“ä»£ç ~

```json
"scripts": {
  "build": "pnpm run clean && rollup -c",
  "clean": "rimraf lib dist es"
}
```

æ„å»ºçš„ç›¸å…³æ­¥éª¤ç»“æŸï¼Œåœ¨ä¹‹åçš„ç‰ˆæœ¬æ§åˆ¶ä¸­ï¼Œé…åˆ `changeset`å¯ä»¥åšåˆ°æ›´å…¨é¢çš„è‡ªåŠ¨åŒ–æ“ä½œã€‚

## æ–‡æ¡£ç«™ç‚¹

æ–‡æ¡£ç½‘ç«™â€”â€”å…¶åŠŸèƒ½æ€§å’Œé‡è¦æ€§ä¸è¨€è€Œå–»ï¼Œä¸»è¦ä½œä¸ºç¬¬ä¸€å…¥å£æä¾›ç»™ç”¨æˆ·ï¼Œä½œä¸ºäº†è§£æœ¬é¡¹ç›®çš„ç¬¬ä¸€é€”å¾„ã€‚

1. ç¬¬ä¸€è¦ç´ ï¼šåŸºæœ¬å†…å®¹åº”åŒ…å«ï¼Œä½¿ç”¨æŒ‡å—ï¼Œç»„ä»¶ APIã€å±æ€§ã€æ–¹æ³•ç­‰ç›¸å…³ä»‹ç»è¯´æ˜ç­‰ã€‚
2. ç¬¬äºŒç‚¹ï¼šä½¿ç”¨æ–¹å¼å’Œç”¨æ³•å±•ç¤ºã€‚çœŸå®æ¸²æŸ“ç¯å¢ƒå±•ç¤ºæ•ˆæœï¼Œç›¸å…³ä»£ç ä½¿ç”¨å±•ç¤ºï¼ˆdemo / codeï¼‰ã€‚
3. åœ¨é¡¹ç›®ä»£ç å±‚é¢å¯èƒ½ä¼šæ¶‰åŠåˆ°ä¸çº¦å®šç›®å½•çš„è‡ªåŠ¨åŒ–è„šæœ¬ç”Ÿæˆç›¸å…³ï¼Œè¿›è€Œå¿«é€Ÿè‡ªåŠ¨å®ç°å¦‚ï¼šè·¯ç”±ã€API ç­‰ç›¸å…³åŠŸèƒ½ã€‚

## ç‰ˆæœ¬ç®¡ç†å’ŒåŒ…å‘å¸ƒ

**Changesets** æ˜¯ä¸€ä¸ªç”¨äº **Monorepo** é¡¹ç›®ä¸‹ç‰ˆæœ¬ä»¥åŠ **Changelog** æ–‡ä»¶ç®¡ç†çš„å·¥å…·ã€‚

æœ¬é¡¹ç›®ç›®å‰ä½¿ç”¨çš„æ˜¯ **changeset**è¿›è¡Œå¤šåŒ…ç‰ˆæœ¬ç®¡ç†ï¼Œå®ƒæ‹¥æœ‰äº¤äº’å¼ CLIï¼Œå¯ä»¥éè¦å‹å¥½çš„æ–¹ä¾¿æˆ‘ä»¬ç¡®å®šåŒ…ç‰ˆæœ¬ => ç”Ÿæˆç›¸åº” `CHANGELOG.md`æ—¥å¿—ï¼Œå¹¶æ›´æ–° `package.json` `version`ä¿¡æ¯ï¼Œç„¶åä¸€é”®å‘å¸ƒåŒ…è‡³ npm

> Changesetsçš„å®æˆ˜ä½¿ç”¨ç»†èŠ‚å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼š[Changesets: æµè¡Œçš„ monorepo åœºæ™¯å‘åŒ…å·¥å…·](https://juejin.cn/post/7024827345059971080)

1. `changeset init`

   - æ–°é¡¹ç›®æ‰§è¡Œè¯¥å‘½ä»¤ï¼Œå®Œæˆå¯¹é¡¹ç›®çš„åˆå§‹åŒ–
   - ä¼šåœ¨æ ¹ç›®å½•ä¸‹ç”Ÿæˆ `.changeset` ç›®å½•ï¼Œ`config.json`é…ç½®æ–‡ä»¶ï¼ˆæ³¨æ„åˆ†æ”¯ `"baseBranch": "master"`ï¼‰

2. `changeset`

   - æ‰§è¡Œè¯¥å‘½ä»¤ï¼Œè¿›è¡Œç‰ˆæœ¬ç®¡ç†ï¼Œä¼šäº¤äº’å¼é€‰æ‹©ä¸åŒé¡¹ç›®ï¼Œä»¥åŠç¡®å®šå‘å¸ƒçš„ç‰ˆæœ¬
   - ä¼šç”Ÿæˆä¸€äº› `.md` æ–‡ä»¶åœ¨ç›®å½•ä¸‹ï¼Œä¼šåœ¨ `version` çš„æ—¶å€™æ¶ˆè€—

3. `changeset version`

   - æ¶ˆè€—ä¸Šä¸€æ­¥ç”Ÿæˆçš„ç›¸å…³çš„ä¸€äº›ç‰ˆæœ¬ä¿¡æ¯åŠè®°å½•å†…å®¹çš„ `.md` æ–‡ä»¶ï¼Œå¹¶ç”Ÿæˆæˆ–æ›´æ–° `CHANGELOG.md` æ–‡ä»¶ï¼Œä¹‹å `.md` æ–‡ä»¶ä¼šè¢«è‡ªåŠ¨åˆ é™¤
   - ç›¸åº”çš„ `package.json` ä¸­çš„ `version` ä¿¡æ¯ä¹Ÿä¼šåŒæ­¥æ›´æ–°

4. `changeset publish`

   - å‘å¸ƒåŒ…åˆ°è¿œç¨‹ `npm` æº
   - å‰ç½®æ¡ä»¶æ˜¯ä½ å·²ç»è¿›è¡Œäº† `npm` è´¦æˆ·ç™»å½•ï¼Œå¦‚æœåŒ…åç§°ä¸º `@ah-ailpha/components`è¯¥ç±»å‹ï¼Œè¿˜éœ€è¦åœ¨ `npm` è´¦æˆ·ä¸­è®¾ç½®ç»„ç»‡

### npm å‘åŒ…æ³¨æ„äº‹é¡¹

ä¸ºäº†å‘å¸ƒä½¿ç”¨ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åœ¨npmåˆ›å»ºä¸€ä¸ª`@ah-ailpha`ç»„ç»‡ï¼Œç§æœ‰çš„éœ€è¦æ”¶è´¹ï¼Œé€‰æ‹©å…è´¹~

> åœ¨ npm publish ä¹‹å‰ä½ åº”è¯¥å·²ç» npm login ç™»å½•è¿‡äº†~

ä½¿ç”¨`changeset publish`æ—¶ï¼Œä¼šæŠ¥`npm ERR! 402 Payment Required`é”™è¯¯

åŸå› ï¼šæ— æ³•å‘å¸ƒåˆ°ç§æœ‰åŒ…ï¼Œå½“åŒ…åä»¥`@your-name`å¼€å¤´æ—¶ï¼Œ`npm publish`ä¼šé»˜è®¤å‘å¸ƒä¸ºç§æœ‰åŒ…ï¼Œä½†æ˜¯ npm çš„ç§æœ‰åŒ…éœ€è¦ä»˜è´¹

402 é”™è¯¯

```js
npm ERR! code E402
npm ERR! 402 Payment Required - PUT https://registry.npmjs.org/.... - You must sign up for private packages
```

package.jsom é…ç½®

```json
{
  "publishConfig": {
    "access": "public",
    "registry": "https://registry.npmjs.org/"
  }
}
```

### å‘åŒ…åˆ°npm

ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œæˆ‘ä»¬åœ¨è„šæœ¬ä¸­æ·»åŠ å¦‚ä¸‹å‘½ä»¤ï¼š

```json
"scripts": {
  "preversion": "changeset",
  "version": "changeset version && pnpm install --no-frozen-lockfile && pnpm run format:code",
  "release": "pnpm run clean && pnpm run build:packages && changeset publish",
  "release:nobuild": "changeset publish",
}
```

**ç¬¬ä¸€æ­¥**ï¼š

æ‰§è¡Œ `pnpm run preversion` å‘½ä»¤ï¼Œé€šè¿‡äº¤äº’å¼å‘½ä»¤ç¡®å®šç‰ˆæœ¬ï¼ˆç©ºæ ¼â€”â€”é€‰æ‹©ï¼Œå›è½¦â€”â€”ç¡®å®šï¼‰

![monorepo-2](https://cdn.jsdelivr.net/gh/JS-banana/images/vuepress/monorepo-1.gif)

æ­¤æ—¶ï¼Œæˆ‘ä»¬é€‰æ‹©ä¸º 1.5.0ç‰ˆæœ¬ï¼Œæ‰§è¡Œç»“æŸï¼Œ`.changeset`ç›®å½•ä¸‹å›ç”Ÿæˆä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ï¼Œè¿™æ˜¯ç»™ç¬¬äºŒæ­¥å‘½ä»¤ä½¿ç”¨çš„å—ï¼Œæˆ‘ä»¬ä¸ç”¨ç®¡å®ƒ

**ç¬¬äºŒæ­¥**ï¼š

æ‰§è¡Œ `pnpm run version`å‘½ä»¤åï¼Œä¸´æ—¶æ–‡ä»¶ä¼šè¢«æ¶ˆè€—æ‰ï¼Œå¹¶ä¸”ä¼šæ›´æ–° `pro-sqltiptree` ç›®å½•ä¸‹çš„`CHANGELOG.md`æ–‡ä»¶

![monorepo-2](https://cdn.jsdelivr.net/gh/JS-banana/images/vuepress/monorepo-2.png)

**ç¬¬ä¸‰æ­¥**ï¼š

æ‰§è¡Œ `changeset publish`å‘½ä»¤ï¼Œå‘å¸ƒnpmåŒ…ï¼Œè¿™é‡Œæˆ‘ä¸ºäº†æµ‹è¯•ï¼Œç›´æ¥ä½¿ç”¨ `pnpm run release:nobuild`

> åœ¨æ‰§è¡Œå‘å¸ƒå‘½ä»¤ä¹‹å‰ï¼Œä½ åº”è¯¥å·²ç»é€šè¿‡ `npm login` è¿›è¡Œäº†ç™»å½•æ“ä½œ

![monorepo-3](https://cdn.jsdelivr.net/gh/JS-banana/images/vuepress/monorepo-3.gif)

**ç¬¬å››æ­¥**ï¼š

åœ¨npmæŸ¥çœ‹æ›´æ–°

![monorepo-4](https://cdn.jsdelivr.net/gh/JS-banana/images/vuepress/monorepo-4.png)

## æ€»ç»“

## ä»“åº“åœ°å€

[https://github.com/JS-banana/jack](https://github.com/JS-banana/jack)

## èµ„æ–™

- [pnpm](https://pnpm.io/zh)
- [pnpm-workspaces](https://pnpm.io/zh/workspaces)
- [element](https://github.com/ElemeFE/element)
- [vuetify](https://github.com/vuetifyjs/vuetify)
- [element-plus](https://github.com/element-plus/element-plus)
- [idux](https://github.com/IDuxFE/idux)
- [lernajs](https://www.lernajs.cn/)
- [Lerna è¿è¡Œæµç¨‹å‰–æ](https://www.zoo.team/article/lerna-js)
- [pnpm å¤šåŒ…ç®¡ç†é¡¹ç›®-çˆ±ä»£ç çˆ±ç¼–ç¨‹](https://icode.best/i/54395246194902)
- [Changesets: æµè¡Œçš„ monorepo åœºæ™¯å‘åŒ…å·¥å…·](https://juejin.cn/post/7024827345059971080)
- [ã€ä¸€åº“ã€‘semverï¼šè¯­ä¹‰ç‰ˆæœ¬å·æ ‡å‡† + npmçš„ç‰ˆæœ¬æ§åˆ¶å™¨ğŸ§²](https://juejin.cn/post/7122240572491825160)
