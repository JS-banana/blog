---
title: ã€viteã€‘vite + vue3 + setup + pinia + ts
date: 2021-11-22 19:26:19
permalink: /pages/2833ad/
categories:
  - æ–‡ç« 
  - å‰ç«¯
tags:
  - vite
  - vue
---

## ä»‹ç»

ä¸€ä¸ªä½¿ç”¨ `vite` + `vue3` + `pinia` + `ant-design-vue` + `typescript` å®Œæ•´æŠ€æœ¯è·¯çº¿å¼€å‘çš„é¡¹ç›®ï¼Œç§’çº§å¼€å‘æ›´æ–°å¯åŠ¨ã€æ–°çš„`vue3 composition api` ç»“åˆ `setup`çºµäº«ä¸æ»‘èˆ¬çš„å¼€å‘ä½“éªŒã€å…¨æ–°çš„ `pinia`çŠ¶æ€ç®¡ç†å™¨å’Œä¼˜ç§€çš„è®¾è®¡ä½“éªŒï¼ˆ`1k`çš„sizeï¼‰ã€`antd`æ— éšœç¢è¿‡æ¸¡ä½¿ç”¨UIç»„ä»¶åº“ `ant-design-vue`ã€å®‰å…¨é«˜æ•ˆçš„ `typescript`ç±»å‹æ”¯æŒã€ä»£ç è§„èŒƒéªŒè¯ã€å¤šçº§åˆ«çš„æƒé™ç®¡ç†~

<!-- more -->

## å‰è¨€

å‰ä¸¤å¤©æ¥åˆ°äº†ä¸€ä¸ªéœ€æ±‚ï¼Œå°±æ˜¯æŠŠåŸæ¥çš„ä¸€ä¸ªé¡¹ç›®çš„ä¸»è¦åŠŸèƒ½æ¨¡å—å’Œç”¨æˆ·æ¨¡å—æƒé™ç³»ç»ŸæŠ½å‡ºæ¥åšä¸€ä¸ªæ–°åå°é¡¹ç›®ï¼Œå¹¶è¿­ä»£æ–°å¢ä¸€äº›æ–°åŠŸèƒ½ï¼Œçœ‹èµ·æ¥å¥½åƒä¹Ÿæ²¡å•¥ä¸œè¥¿

æ‹¿åˆ°æºç çœ‹äº†ä¸‹é¡¹ç›®ï¼Œå¥½å®¶ä¼™ï¼ŒåŸé¡¹ç›®æ˜¯ä¸ªå¾®åº”ç”¨é¡¹ç›®ï¼Œä¸»åº”ç”¨ç”¨æˆ·æ¨¡å—æ˜¯`react`æŠ€æœ¯æ ˆï¼Œå­åº”ç”¨æ¨¡å—æ˜¯`vue2`æŠ€æœ¯æ ˆï¼Œè¿™ç›´æ¥ CVå¤§æ³•çœ‹æ ·å­æ˜¯ä¸è¡Œäº†ğŸ‘€ï¼Œæˆ‘è¿™è¦åšçš„æ¯•ç«Ÿæ˜¯ä¸ªå•é¡µé¢åº”ç”¨ï¼Œç¡®å®šä¸€ä¸ªæŠ€æœ¯è·¯çº¿å³å¯ï¼Œå…·ä½“çœ‹ä¸‹ä»£ç é€»è¾‘å¹¶è·‘èµ·æ¥çœ‹çœ‹

è·‘èµ·æ¥è¯•äº†ä¸‹ï¼Œä¸¤ä¸ªé¡¹ç›®åŸºæœ¬éƒ½æ˜¯1åˆ†é’Ÿå·¦å³å¯åŠ¨ï¼Œçœ‹ä»£ç vueé¡¹ç›®æ•´ä¸ªä¸šåŠ¡é€»è¾‘ä»£ç éƒ½æ‹§åœ¨ä¸€å—å†™äº†

æƒ³åˆ°ä¹‹å‰é—®è€å¤§è¦æºç çš„æ—¶å€™ï¼Œè¯´é‚£ä¸ªæ˜¯è€é¡¹ç›®äº†ï¼Œé‡æ–°æ­ä¸€ä¸ªå†™åº”è¯¥ä¼šå¿«ç‚¹

è¿™è¯æ²¡æ¯›ç—…å•Šï¼Œè¯ä¸å¤šè¯´ï¼Œç›´æ¥å¼€æ•´ï¼Œè¿™æ¬¡ç›´æ¥ä¸Š `vite` + `vue3`

## ç‰¹æ€§

- âœ¨è„šæ‰‹æ¶å·¥å…·ï¼šé«˜æ•ˆã€å¿«é€Ÿçš„ **Vite**
- ğŸ”¥å‰ç«¯æ¡†æ¶ï¼šçœ¼ä¸‹æœ€æ—¶é«¦çš„ **Vue3**
- ğŸçŠ¶æ€ç®¡ç†å™¨ï¼š`vue3`æ–°ç§€ **Pinia**ï¼ŒçŠ¹å¦‚ `react zustand`èˆ¬çš„ä½“éªŒï¼Œå‹å¥½çš„apiå’Œå¼‚æ­¥å¤„ç†
- ğŸ†å¼€å‘è¯­è¨€ï¼šæ”¿æ²»æ­£ç¡® **TypeScript**
- ğŸ‰UIç»„ä»¶ï¼š`antd`å¼€å‘è€…æ— éšœç¢è¿‡æ¸¡ä½¿ç”¨ **ant-design-vue**ï¼Œç†Ÿæ‚‰çš„é…æ–¹ç†Ÿæ‚‰çš„å‘³é“
- ğŸ¨cssæ ·å¼ï¼š**less** ã€`postcss`
- ğŸ“–ä»£ç è§„èŒƒï¼š**Eslint**ã€**Prettier**ã€**Commitlint**
- ğŸ”’æƒé™ç®¡ç†ï¼šé¡µé¢çº§ã€èœå•çº§ã€æŒ‰é’®çº§ã€æ¥å£çº§
- âœŠä¾èµ–æŒ‰éœ€åŠ è½½ï¼š**unplugin-auto-import**ï¼Œå¯è‡ªåŠ¨å¯¼å…¥ä½¿ç”¨åˆ°çš„`vue`ã€`vue-router`ç­‰ä¾èµ–
- ğŸ’ªç»„ä»¶æŒ‰éœ€å¯¼å…¥ï¼š**unplugin-vue-components**ï¼Œæ— è®ºæ˜¯ç¬¬ä¸‰æ–¹UIç»„ä»¶è¿˜æ˜¯è‡ªå®šä¹‰ç»„ä»¶éƒ½å¯å®ç°è‡ªåŠ¨æŒ‰éœ€å¯¼å…¥ä»¥åŠ`TS`è¯­æ³•æç¤º

## é¡¹ç›®ç›®å½•

```js
â”œâ”€â”€ .husky                              // husky git hooksé…ç½®ç›®å½•
    â”œâ”€â”€ _                               // husky è„šæœ¬ç”Ÿæˆçš„ç›®å½•æ–‡ä»¶
    â”œâ”€â”€ commit-msg                      // commit-msgé’©å­ï¼Œç”¨äºéªŒè¯ messageæ ¼å¼
    â”œâ”€â”€ pre-commit                      // pre-commité’©å­ï¼Œä¸»è¦æ˜¯å’Œeslinté…åˆ
â”œâ”€â”€ config                              // å…¨å±€é…ç½®æ–‡ä»¶
    â”œâ”€â”€ vite                            // vite ç›¸å…³é…ç½®
    â”œâ”€â”€ constant.ts                     // é¡¹ç›®é…ç½®
    â”œâ”€â”€ themeConfig.ts                  // ä¸»é¢˜é…ç½®
â”œâ”€â”€ dist                                // é»˜è®¤çš„ build è¾“å‡ºç›®å½•
â”œâ”€â”€ mock                                // å‰ç«¯æ•°æ®mock
â”œâ”€â”€ public                              // viteé¡¹ç›®ä¸‹çš„é™æ€ç›®å½•
â””â”€â”€ src                                 // æºç ç›®å½•
    â”œâ”€â”€ api                             // æ¥å£ç›¸å…³
    â”œâ”€â”€ assets                          // å…¬å…±çš„æ–‡ä»¶ï¼ˆå¦‚imageã€cssã€fontç­‰ï¼‰
    â”œâ”€â”€ components                      // é¡¹ç›®ç»„ä»¶
    â”œâ”€â”€ directives                      // è‡ªå®šä¹‰ æŒ‡ä»¤
    â”œâ”€â”€ enums                           // è‡ªå®šä¹‰ å¸¸é‡ï¼ˆæšä¸¾å†™æ³•ï¼‰
    â”œâ”€â”€ hooks                           // è‡ªå®šä¹‰ hooks
    â”œâ”€â”€ layout                          // å…¨å±€å¸ƒå±€
    â”œâ”€â”€ router                          // è·¯ç”±
    â”œâ”€â”€ store                           // çŠ¶æ€ç®¡ç†å™¨
    â”œâ”€â”€ utils                           // å·¥å…·åº“
    â”œâ”€â”€ views                           // é¡µé¢æ¨¡å—ç›®å½•
        â”œâ”€â”€ login                       // loginé¡µé¢æ¨¡å—
        â”œâ”€â”€ ...
    â”œâ”€â”€ App.vue                         // vueé¡¶å±‚æ–‡ä»¶
    â”œâ”€â”€ auto-imports.d.ts               // unplugin-auto-import æ’ä»¶ç”Ÿæˆ
    â”œâ”€â”€ components.d.d.ts               // unplugin-vue-components æ’ä»¶ç”Ÿæˆ
    â”œâ”€â”€ main.ts                         // é¡¹ç›®å…¥å£æ–‡ä»¶
    â”œâ”€â”€ shimes-vue.d.ts                 // viteé»˜è®¤tsç±»å‹æ–‡ä»¶
    â”œâ”€â”€ types                           // é¡¹ç›®typeç±»å‹å®šä¹‰æ–‡ä»¶å¤¹
â”œâ”€â”€ .editorconfig                       // IDEæ ¼å¼è§„èŒƒ
â”œâ”€â”€ .env                                // ç¯å¢ƒå˜é‡
â”œâ”€â”€ .eslintignore                       // eslintå¿½ç•¥
â”œâ”€â”€ .eslintrc                           // eslinté…ç½®æ–‡ä»¶
â”œâ”€â”€ .gitignore                          // gitå¿½ç•¥
â”œâ”€â”€ .npmrc                              // npmé…ç½®æ–‡ä»¶
â”œâ”€â”€ .prettierignore                     // prettiercå¿½ç•¥
â”œâ”€â”€ .prettierrc                         // prettiercé…ç½®æ–‡ä»¶
â”œâ”€â”€ index.html                          // å…¥å£æ–‡ä»¶
â”œâ”€â”€ LICENSE.md                          // LICENSE
â”œâ”€â”€ package.json                        // package
â”œâ”€â”€ pnpm-lock.yaml                      // pnpm-lock
â”œâ”€â”€ postcss.config.js                   // postcss
â”œâ”€â”€ README.md                           // README
â”œâ”€â”€ tsconfig.json                       // typescripté…ç½®æ–‡ä»¶
â””â”€â”€ vite.config.ts                      // vite
```

## å¼€å‘

### é¡¹ç›®åˆå§‹åŒ–

> å¦‚æœä½¿ç”¨vscodeç¼–è¾‘å™¨å¼€å‘vue3ï¼Œè¯·åŠ¡å¿…å®‰è£…Volaræ’ä»¶ä¸vue3é…åˆä½¿ç”¨æ›´ä½³ï¼ˆä¸åŸæœ¬çš„Veturä¸å…¼å®¹ï¼‰

ä½¿ç”¨ [vite cli](https://cn.vitejs.dev/guide/) å¿«é€Ÿåˆ›å»ºé¡¹ç›®

`yarn create vite project-name --template vue-ts`

### å®‰è£…ç›¸å…³ä¾èµ–

æ¨èä½¿ç”¨æ–°ä¸€ä»£ `pnpm` åŒ…ç®¡ç†å·¥å…·ï¼Œæ€§èƒ½å’Œé€Ÿåº¦ä»¥åŠ `node_modules`ä¾èµ–ç®¡ç†éƒ½å¾ˆä¼˜ç§€

å»ºè®®é…åˆ `.npmrc` é…ç½®ä½¿ç”¨

```sh
# æå‡ä¸€äº›ä¾èµ–åŒ…è‡³ node_modules
# è§£å†³éƒ¨åˆ†åŒ…æ¨¡å—not foundçš„é—®é¢˜
# ç”¨äºé…åˆ pnpm
shamefully-hoist = true

# node-sass ä¸‹è½½é—®é¢˜
# sass_binary_site="https://npm.taobao.org/mirrors/node-sass/"
```

## ä»£ç è§„èŒƒ

å·¥å…·ï¼š`husky`ã€`eslint`ã€`prettier`

å…·ä½“ä½¿ç”¨æ–¹å¼ï¼Œç½‘ä¸Šå¾ˆå¤šï¼Œæˆ‘åœ¨ä¹‹å‰å¦ä¸€ç¯‡æ–‡ç« ä¹Ÿæœ‰è¯´è¿‡ï¼Œè¿™é‡Œä¸å†èµ˜è¿°~

[a Vite2 + Typescript + React + Antd + Less + Eslint + Prettier + Precommit template](https://github.com/JS-banana/vite-react-ts)

ä¸»è¦å°±æ˜¯è‡ªåŠ¨åŒ–çš„æ¦‚å¿µï¼Œåœ¨ä¸€ä¸ªåˆé€‚çš„æ—¶æœºå®Œæˆè§„å®šçš„äº‹

- ç»“åˆVsCodeç¼–è¾‘å™¨ï¼ˆä¿å­˜æ—¶è‡ªåŠ¨æ‰§è¡Œæ ¼å¼åŒ–ï¼š`"editor.formatOnSave": true`ï¼‰
- é…åˆGit hooksé’©å­ï¼ˆcommitå‰æˆ–æäº¤å‰æ‰§è¡Œï¼š`npm run lint:lint-staged`ï¼‰

æ³¨æ„ï¼š

é’ˆå¯¹ä¸åŒç³»ç»Ÿ `commitlint`å®‰è£…æ–¹å¼æœ‰æ‰€ä¸åŒ [commitlint](https://github.com/conventional-changelog/commitlint)

```sh
# Install commitlint cli and conventional config
npm install --save-dev @commitlint/{config-conventional,cli}
# For Windows:
npm install --save-dev @commitlint/config-conventional @commitlint/cli
```

## åŠŸèƒ½

### vueèƒ½åŠ›æ”¯æŒ

viteä½œä¸ºvueä¹‹çˆ¶å°¤å¤§çš„ä½œå“ï¼Œä¹Ÿæ˜¯åšåˆ°äº†å¯¹vueçš„ç¬¬ä¸€ä¼˜å…ˆæ”¯æŒï¼Œå¾ˆå¤šåŠŸèƒ½ç‰¹æ€§æ¡†æ¶å·²è‡ªå¸¦

ä¸€äº›å¿…é¡»çš„æ’ä»¶

```json
{
    // "@vitejs/plugin-legacy": "^1.6.2", // ä½ç‰ˆæœ¬æµè§ˆå™¨å…¼å®¹
    "@vitejs/plugin-vue": "^1.9.3", // vue æ”¯æŒ
    "@vitejs/plugin-vue-jsx": "^1.2.0", // jsx æ”¯æŒ
}
```

### çŠ¶æ€ç®¡ç†å™¨ Pinia

vueæ–°ä¸€ä»£çŠ¶æ€ç®¡ç†å™¨ï¼Œç”¨è¿‡ react zustandçš„åŒå­¦åº”è¯¥ä¼šæœ‰å¾ˆç†Ÿæ‚‰çš„æ„Ÿè§‰

> Piniaæ˜¯ä¸€ä¸ªå›´ç»•Vue 3 Composition APIçš„å°è£…å™¨ã€‚å› æ­¤ï¼Œä½ ä¸å¿…æŠŠå®ƒä½œä¸ºä¸€ä¸ªæ’ä»¶æ¥åˆå§‹åŒ–ï¼Œé™¤éä½ éœ€è¦Vue devtoolsæ”¯æŒã€SSRæ”¯æŒå’Œwebpackä»£ç åˆ†å‰²çš„æƒ…å†µ

- éå¸¸è½»é‡åŒ–ï¼Œä»…æœ‰ 1 KB
- ç›´è§‚çš„APIä½¿ç”¨ï¼Œç¬¦åˆç›´è§‰ï¼Œæ˜“äºå­¦ä¹ 
- æ¨¡å—åŒ–è®¾è®¡ï¼Œä¾¿äºæ‹†åˆ†çŠ¶æ€
- å…¨é¢çš„TSæ”¯æŒ

### UIç»„ä»¶æŒ‰éœ€åŠ è½½ã€è‡ªåŠ¨å¯¼å…¥

äº†è§£åŸºæœ¬æ¦‚å¿µï¼švite è‡ªå¸¦æŒ‰éœ€åŠ è½½ï¼ˆé’ˆå¯¹jsï¼‰ï¼Œæˆ‘ä»¬è¿™é‡Œä¸»è¦é’ˆå¯¹æ ·å¼åšæŒ‰éœ€åŠ è½½å¤„ç†

#### æ–¹æ¡ˆä¸€ï¼švite-plugin-style-import

```js
import styleImport from 'vite-plugin-style-import'

// 
plugins:[
  styleImport({
    libs: [
      {
        libraryName: 'ant-design-vue',
        esModule: true,
        resolveStyle: (name) => {
          return `ant-design-vue/es/${name}/style/index`
        },
      }
    ]
  })
]
```

<!-- ä¸è¿‡ï¼Œæˆ‘ä¹‹å‰åœ¨å†™ `vite` + `react` æ—¶ï¼Œä½¿ç”¨`vite-plugin-style-import`è¿™ä¸ªæ’ä»¶é‡åˆ°è¿‡çƒ­æ›´æ–°æ ·å¼ä¸åŒæ­¥çš„ä¸€äº›é—®é¢˜ -->

#### æ–¹æ¡ˆäºŒï¼šunplugin-vue-components

æ¨èä½¿ç”¨ [unplugin-vue-components](https://github.com/antfu/unplugin-vue-components) æ’ä»¶

è¯¥æ’ä»¶åªéœ€åœ¨ vite pluginä¸­æ·»åŠ å¯¹åº” `AntDesignVueResolver` å³å¯ï¼Œä¹Ÿæ”¯æŒè‡ªå®šä¹‰çš„ `components` è‡ªåŠ¨æ³¨å†Œï¼Œå¾ˆæ–¹ä¾¿

```ts
import { AntDesignVueResolver } from 'unplugin-vue-components/resolvers';
import Components from 'unplugin-vue-components/vite';

// vite.config.ts plugins æ·»åŠ å¦‚ä¸‹é…ç½®
export default defineConfig({
  plugins: [
    Components({
      resolvers: [
        AntDesignVueResolver(), // ant-design-vue
        // ElementPlusResolver(), // Element Plus
        // VantResolver(), // Vant
      ]
    })
  ]
})
```

å½“ç„¶è¿™é‡Œå¦‚æœæ²¡æœ‰ä½ ä½¿ç”¨çš„å¯¹åº”çš„UIæ¡†æ¶çš„ `Resolver`åŠ è½½å™¨ï¼Œä¹Ÿæ²¡å…³ç³»ï¼Œä¹Ÿæ”¯æŒè‡ªå®šä¹‰é…ç½®

```ts
Components({
  resolvers: [
    // example of importing Vant
    (name) => {
      // where `name` is always CapitalCase
      if (name.startsWith('Van'))
        return { importName: name.slice(3), path: 'vant' }
    }
  ]
})
```

----

å¦ä¸€å¼ºæ‚åŠŸèƒ½ï¼šè¯¥æ’ä»¶ä¸ä»…æ”¯æŒUIæ¡†æ¶ç»„ä»¶çš„æŒ‰éœ€å¯¼å…¥ï¼Œä¹Ÿæ”¯æŒé¡¹ç›®ç»„ä»¶çš„è‡ªåŠ¨æŒ‰éœ€å¯¼å…¥

> å…·ä½“è¡¨ç°å°±æ˜¯ï¼šå¦‚æˆ‘ä»¬ä½¿ç”¨ ant-design-vueçš„ Cardç»„ä»¶æˆ–æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„ components/Icon ç­‰å…¶ä»–ç»„ä»¶æ—¶ï¼Œæˆ‘ä»¬ä¸ç”¨å¯¼å…¥ï¼Œç›´æ¥ç”¨å³å¯ï¼Œæ’ä»¶ä¼šä¸ºæˆ‘ä»¬è‡ªåŠ¨æŒ‰éœ€å¯¼å…¥ï¼Œç»“åˆ TSè¯­æ³•æç¤ºï¼Œå¼€å‘æ•ˆç‡æ æ çš„~

é…ç½®å¦‚ä¸‹:

```ts
Components({
  // allow auto load markdown components under `./src/components/`
  extensions: ['vue'],

  // allow auto import and register components
  include: [/\.vue$/, /\.vue\?vue/],

  dts: 'src/components.d.ts',
})
```

éœ€è¦åœ¨`src`ç›®å½•ä¸‹æ·»åŠ  `components.d.ts`æ–‡ä»¶é…åˆä½¿ç”¨ï¼Œè¯¥æ–‡ä»¶ä¼šè¢«æ’ä»¶è‡ªåŠ¨æ›´æ–°

- `components.d.ts` ä½œç”¨

ç›´æ¥çš„ä½œç”¨æ˜¯ï¼šåœ¨é¡¹ç›®ä¸‹ç”Ÿæˆå¯¹åº”`.d.ts`typeç±»å‹æ–‡ä»¶ï¼Œç”¨äºè¯­æ³•æç¤ºä¸ç±»å‹æ£€æµ‹é€šè¿‡

- **æ³¨æ„**

> `"unplugin-vue-components": "^0.17.2"`

å½“å‰ç‰ˆæœ¬å·²çŸ¥é—®é¢˜ï¼š[issues 174](https://github.com/antfu/unplugin-vue-components/issues/174)

å¯¹äº `ant-design-vue` çš„ `notification` / `message` ç»„ä»¶ï¼Œå½“åœ¨ `js`ä¸­ä½¿ç”¨æ—¶ï¼Œè¯¥æ’ä»¶ä¸ä¼šæ‰§è¡Œè‡ªåŠ¨å¯¼å…¥èƒ½åŠ›ï¼ˆæ ·å¼ä¸ä¼šè¢«å¯¼å…¥ï¼‰

æœ€ç»ˆæ•ˆæœæ˜¯ï¼š`message.success('xx')`å¯ä»¥åˆ›å»º `DOM`å…ƒç´ ï¼Œä½†æ˜¯æ²¡æœ‰ç›¸å…³æ ·å¼ä»£ç 

å› ä¸ºè¯¥æ’ä»¶çš„è®¾è®¡åŸç†æ˜¯æ ¹æ® vue `template` æ¨¡æ¿ä¸­çš„ç»„ä»¶ä½¿ç”¨è¿›è¡Œå¤„ç†çš„ï¼Œå‡½æ•°å¼è°ƒç”¨æ—¶æ’ä»¶æŸ¥è¯¢ä¸åˆ°

è§£å†³æ–¹æ¡ˆï¼š

- æ”¹ç”¨`vite-plugin-style-import` æ’ä»¶
- æ‰‹åŠ¨å…¨å±€å¼•å…¥ messageç»„ä»¶æ ·å¼ï¼Œ`import 'ant-design-vue/es/message/style'`
- åœ¨vueç»„ä»¶çš„ templateä¸­æ‰‹åŠ¨æ·»åŠ  `<a-message />` ä¾›æ’ä»¶ç´¢å¼•ä¾èµ–æ—¶ä½¿ç”¨

### ä¾èµ–æŒ‰éœ€è‡ªåŠ¨å¯¼å…¥

- **unplugin-auto-import**

vueç›¸å…³ `defineComponent` ã€`computed` ã€`watch`ç­‰æ¨¡å—ä¾èµ–æ ¹æ®ä½¿ç”¨ï¼Œæ’ä»¶è‡ªåŠ¨å¯¼å…¥ï¼Œä½ æ— éœ€å…³å¿ƒ `import`ï¼Œç›´æ¥ä½¿ç”¨å³å¯

è¯¥æ’ä»¶é»˜è®¤æ”¯æŒï¼š

- `vue`
- `vue-router`
- `vue-i18n`
- `@vueuse/head`
- `@vueuse/core`
- ...

å½“ç„¶ä½ ä¹Ÿå¯ä»¥è‡ªå®šä¹‰é…ç½® [unplugin-auto-import](https://github.com/antfu/unplugin-auto-import#readme)

ç”¨æ³•å¦‚ä¸‹ï¼š

```ts
import AutoImport from 'unplugin-auto-import/vite'

export default defineConfig({
  // ...
  plugins: [
    AutoImport({
      imports: [
        'vue',
        'vue-router',
        'vue-i18n',
        '@vueuse/head',
        '@vueuse/core',
      ],
      dts: 'src/auto-imports.d.ts',
    })
  ]
})
```

éœ€è¦åœ¨`src`ç›®å½•ä¸‹æ·»åŠ  `auto-imports.d.ts`æ–‡ä»¶é…åˆä½¿ç”¨ï¼Œè¯¥æ–‡ä»¶ä¼šè¢«æ’ä»¶è‡ªåŠ¨æ›´æ–°

æœ€ç»ˆæ•ˆæœä¸ºï¼š

å¦‚ `ref`æ–¹æ³•æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨å¹¶æœ‰ç›¸åº”çš„TSè¯­æ³•æç¤ºï¼Œè€Œä¸éœ€è¦æ‰‹åŠ¨çš„å» `import { ref } from 'vue'`

### è‡ªå®šä¹‰ä¸»é¢˜

è‡ªå®šä¹‰ä¸»é¢˜è®¾ç½®å‚è€ƒå®˜æ–¹æ–‡æ¡£é…ç½®å³å¯ï¼Œä¸¤ç§å¸¸è§„æ–¹å¼

1. æŒ‰éœ€åŠ è½½é…åˆ `webpack/vite` loaderå±æ€§ä¿®æ”¹å˜é‡
2. å…¨é‡å¼•å…¥ï¼Œé…åˆ `variables.less`è‡ªå®šä¹‰æ ·å¼è¦†ç›–æ¡†æ¶ä¸»é¢˜æ ·å¼

è¿™é‡Œæˆ‘ä»¬é‡‡ç”¨ç¬¬ä¸€ç§æ–¹æ³•é€šè¿‡loaderé…ç½®é…åˆæŒ‰éœ€åŠ è½½é£Ÿç”¨

```ts
css: {
  preprocessorOptions: {
    less: {
      modifyVars: { 'primary-color': 'red' },
      javascriptEnabled: true, // è¿™æ˜¯å¿…é¡»çš„
    },
  },
}
```

**æ³¨æ„**ï¼šåœ¨ä½¿ç”¨äº† `unplugin-vue-components`è¿›è¡ŒæŒ‰éœ€åŠ è½½é…ç½®åï¼Œç›¸å…³ lesså˜é‡è®¾ç½®éœ€è¦åŒæ­¥å¼€å¯ `importStyle: 'less'`ï¼Œ[unplugin-vue-components issues 160](https://github.com/antfu/unplugin-vue-components/issues/160)

```ts
AntDesignVueResolver({ importStyle: 'less' }) // è¿™é‡Œå¾ˆé‡è¦
```

### mockæ•°æ®

- **vite-plugin-mock** æ’ä»¶

vite pluginé…ç½®

```ts
viteMockServe({
  ignore: /^\_/,
  mockPath: 'mock',
  localEnabled: true,
  prodEnabled: false,
  injectCode: `
      import { setupProdMockServer } from '../mock/_createProductionServer';

      setupProdMockServer();
      `,
})
```

æ ¹ç›®å½•ä¸‹åˆ›å»º `_createProductionServer.ts`æ–‡ä»¶

```ts
import { createProdMockServer } from 'vite-plugin-mock/es/createProdMockServer';

// æ‰¹é‡åŠ è½½
const modules = import.meta.globEager('./**/*.ts');

const mockModules: any[] = [];
Object.keys(modules).forEach((key) => {
  if (key.includes('/_')) {
    return;
  }
  mockModules.push(...modules[key].default);
});

/**
 * Used in a production environment. Need to manually import all modules
 */
export function setupProdMockServer() {
  createProdMockServer(mockModules);
}
```

è¿™æ ·mockç›®å½•ä¸‹çš„é `_`å¼€å¤´æ–‡ä»¶éƒ½ä¼šè¢«è‡ªåŠ¨åŠ è½½æˆmockæ–‡ä»¶

å¦‚ï¼š

```ts
import Mock from 'mockjs';

const data = Mock.mock({
  'items|30': [
    {
      id: '@id',
      title: '@sentence(10, 20)',
      account: '@phone',
      true_name: '@name',
      created_at: '@datetime',
      role_name: '@name',
    },
  ],
});

export default [
  {
    url: '/table/list',
    method: 'get',
    response: () => {
      const items = data.items;
      return {
        code: 0,
        result: {
          total: items.length,
          list: items,
        },
      };
    },
  },
];
```

é…ç½®å¥½ä»£ç†ç›´æ¥è¯·æ±‚ `/api/table/list` å°±å¯ä»¥å¾—åˆ°æ•°æ®äº†

### Proxyä»£ç†

```ts
import proxy from './config/vite/proxy';

export default defineConfig({
  // server
  server: {
    hmr: { overlay: false }, // ç¦ç”¨æˆ–é…ç½® HMR è¿æ¥ è®¾ç½® server.hmr.overlay ä¸º false å¯ä»¥ç¦ç”¨æœåŠ¡å™¨é”™è¯¯é®ç½©å±‚
    // æœåŠ¡é…ç½®
    port: VITE_PORT, // ç±»å‹ï¼š number æŒ‡å®šæœåŠ¡å™¨ç«¯å£;
    open: false, // ç±»å‹ï¼š boolean | stringåœ¨æœåŠ¡å™¨å¯åŠ¨æ—¶è‡ªåŠ¨åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€åº”ç”¨ç¨‹åºï¼›
    cors: false, // ç±»å‹ï¼š boolean | CorsOptions ä¸ºå¼€å‘æœåŠ¡å™¨é…ç½® CORSã€‚é»˜è®¤å¯ç”¨å¹¶å…è®¸ä»»ä½•æº
    host: '0.0.0.0', // æ”¯æŒä»IPå¯åŠ¨è®¿é—®
    proxy,
  },
})
```

proxy å¦‚ä¸‹

```ts
import {
  API_BASE_URL,
  API_TARGET_URL,
} from '../../config/constant';
import { ProxyOptions } from 'vite';

type ProxyTargetList = Record<string, ProxyOptions>;

const ret: ProxyTargetList = {
  // test
  [API_BASE_URL]: {
    target: API_TARGET_URL,
    changeOrigin: true,
    rewrite: (path) => path.replace(new RegExp(`^${API_BASE_URL}`), ''),
  },
  // mock
  // [MOCK_API_BASE_URL]: {
  //   target: MOCK_API_TARGET_URL,
  //   changeOrigin: true,
  //   rewrite: (path) => path.replace(new RegExp(`^${MOCK_API_BASE_URL}`), '/api'),
  // },
};

export default ret;
```

### ç¯å¢ƒå˜é‡ .env

æˆ‘è¿™è¾¹æ˜¯æŠŠç³»ç»Ÿé…ç½®æ”¾åˆ° `config/constant.ts` ç®¡ç†äº†

ä¸ºäº†æ–¹ä¾¿ç®¡ç†ä¸åŒç¯å¢ƒçš„æ¥å£å’Œå‚æ•°é…ç½®ï¼Œå¯ä»¥ä½¿ç”¨ç¯å¢ƒå˜é‡ .envï¼Œå¦‚ .envã€.env.localã€.env.developmentã€.env.production

é…åˆ `dotenv`åº“ ä½¿ç”¨è¿˜æ˜¯å¾ˆæ–¹ä¾¿çš„

### åŒ…ä¾èµ–åˆ†æå¯è§†åŒ–

æ’ä»¶ï¼š`rollup-plugin-visualizer`

```ts
import visualizer from 'rollup-plugin-visualizer';

visualizer({
  filename: './node_modules/.cache/visualizer/stats.html',
  open: true,
  gzipSize: true,
  brotliSize: true,
})
```

### ä»£ç å‹ç¼©

æ’ä»¶ï¼š`vite-plugin-compression`

```ts
import compressPlugin from 'vite-plugin-compression';

compressPlugin({
  ext: '.gz',
  deleteOriginFile: false,
})
```

### å…¼å®¹å¤„ç†

æ’ä»¶ï¼š`@vitejs/plugin-legacy`

å…¼å®¹ä¸æ”¯æŒ `<script type="module">`ç‰¹æ€§çš„æµè§ˆå™¨ï¼Œæˆ– IEæµè§ˆå™¨

```ts
// Native ESM
legacy({
  targets: ['defaults', 'not IE 11']
})

// IE11
// éœ€è¦ regenerator-runtime
legacy({
  targets: ['ie >= 11'],
  additionalLegacyPolyfills: ['regenerator-runtime/runtime']
})
```

### æ•ˆæœå›¾

å¼€å¯å‹ç¼©ã€å¼€å¯å…¼å®¹åç”Ÿäº§æ‰“åŒ…çš„äº§ç‰©

![vite-vue3-1](https://cdn.jsdelivr.net/gh/JS-banana/images/vuepress/vite-vue3-1.jpg)

----

åŒ…ä¾èµ–åˆ†æå¯è§†åŒ–ï¼Œéƒ¨åˆ†æˆªå›¾

![vite-vue3-2](https://cdn.jsdelivr.net/gh/JS-banana/images/vuepress/vite-vue3-2.jpg)

### è·¯ç”±å’Œå¸ƒå±€

> æ³¨æ„æ–°ç‰ˆè·¯ç”± `vue-router4.x` æ˜¯æœ‰ä¸€äº›å˜åŒ–çš„ï¼Œå‚è€ƒå®˜æ–¹

```ts
// router/index.ts
import { createRouter, createWebHashHistory } from 'vue-router'
import routes from './router.config'

const router = createRouter({
  history: createWebHashHistory(), //
  routes,
})
```

å¸ƒå±€ä½¿ç”¨çš„æ˜¯ `@ant-design-vue/pro-layout` ç»“åˆè·¯ç”±é…ç½®ï¼Œä½¿ç”¨èµ·æ¥æ¯”è¾ƒæ–¹ä¾¿

ç”¨æ³•å¦‚ä¸‹ï¼š

```ts
// router.config.ts
import BasicLayout from '/@/layouts/BasicLayout.vue'; // åŸºæœ¬å¸ƒå±€
import BlankLayout from '/@/layouts/BlankLayout.vue'; // ç©ºå¸ƒå±€
import type { RouteRecordRaw } from 'vue-router';

const routerMap: RouteRecordRaw[] = [
  {
    path: '/',
    name: 'Root',
    redirect: '/app',
    meta: {
      title: 'Root',
    },
  },
  {
    path: '/login',
    component: () => import('/@/views/login/index.vue'),
    name: 'login',
    meta: { title: 'ç™»å½•' },
  },
  {
    path: '/app',
    name: 'index',
    component: BasicLayout,
    redirect: '/app/sys',
    meta: { title: 'ç®¡ç†å¹³å°' },
    children: [
      {
        path: '/app/sys',
        component: BlankLayout,
        name: 'sys',
        redirect: '/app/sys/index',
        meta: {
          title: 'é¦–é¡µ',
          keepAlive: true,
          icon: 'icon-a-SimpleChainlianmenglianjichubantubiao_liulanqi',
        },
        children: [
          {
            path: '/app/sys/index',
            name: 'sys_index',
            component: () => import('/@/views/sys/index.vue'),
            meta: { hideInMenu: true },
          },
          {
            path: '/app/sys/detail',
            name: 'sys_detail',
            component: () => import('/@/views/sys/tradingDetail/index.vue'),
            meta: { title: 'äº¤æ˜“ä¿¡æ¯', breadcrumb: true, hideInMenu: true, hiddenWrap: true },
          },
        ],
      },
    ]
  }
]
```

åœ¨çœ‹çœ‹ `pro-layout`ç»„ä»¶çš„ä½¿ç”¨

```vue
<template>
  <pro-layout
    :locale="locale"
    v-bind="layoutConf"
    v-model:openKeys="state.openKeys"
    v-model:collapsed="state.collapsed"
    v-model:selectedKeys="state.selectedKeys"
    :breadcrumb="{ routes: breadcrumb }"
  >
    <router-view />
  </pro-layout>
</template>  

<script setup lang="ts">
const { menuData } = getMenuData(clearMenuItem(router.getRoutes()));

const layoutConf = reactive<BasicLayoutProps>({
  menuData: menuData, // èœå•æ•°æ®
  ...prolayoutSetting, // åŸºæœ¬è®¾ç½®
});

</script>  
```

æ ¹æ®å®é™…æƒ…å†µå¯ä»¥è‡ªå®šä¹‰å¤„ç† menuDataæ•°æ®ï¼Œå¦‚æˆ‘è¿™é‡Œ

`const menuData = clearMenuItem(router.getRoutes()).filter((n) => n.path.startsWith('/app/'))`

- `hideInMenu` å±æ€§æ˜¯é…åˆ pro-layoutç»„ä»¶ä½¿ç”¨çš„ï¼Œå¯ä»¥ä½¿è¯¥èœå•é¡¹ä¸ä¼šåœ¨èœå•ä¸­æ˜¾ç¤ºï¼Œå¦‚ä¸æƒ³è®© `/app/sys`å¸¦æœ‰å­èœå•
- `breadcrumb`ã€`hiddenWrap`åˆ™æ˜¯æˆ‘æ ¹æ®è‡ªèº«éœ€æ±‚æ·»åŠ çš„

### æƒé™

- æ”¯æŒé¡µé¢å’Œèœå•çº§åˆ«çš„æƒé™ç®¡ç†ã€è·¯ç”±ç®¡ç†
- æ”¯æŒæŒ‰é’®çº§åˆ«çš„æƒé™ç®¡ç†
- æ”¯æŒæ¥å£çº§åˆ«çš„æƒé™ç®¡ç†

å‡ ä¸ªå…³é”®è¯ï¼š`router.addRoutes`åŠ¨æ€è·¯ç”±ã€`v-auth`æŒ‡ä»¤ã€`axios`æ‹¦æˆª

## å‚è€ƒ

- [vue3](https://v3.vuejs.org/)
- [Pinia](https://pinia.esm.dev/)
- [Vue Router](https://next.router.vuejs.org/)
- [vue-vben-admin](https://github.com/anncwb/vue-vben-admin)
- [ä¸€ä¸ªç®€å•çš„VueæŒ‰é’®çº§æƒé™æ–¹æ¡ˆ](https://juejin.cn/post/6844904001012514823)
- [æ‰‹æ‘¸æ‰‹ï¼Œå¸¦ä½ ç”¨vueæ’¸åå° ç³»åˆ—äºŒ(ç™»å½•æƒé™ç¯‡)](https://juejin.cn/post/6844903478880370701)
- [å‰åç«¯åˆ†ç¦»ä¸‹å‰ç«¯æƒé™å¤„ç†](https://juejin.cn/post/6844904003831070727)
