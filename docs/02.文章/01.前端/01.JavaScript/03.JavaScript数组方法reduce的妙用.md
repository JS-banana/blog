---
title: JavaScriptæ•°ç»„æ–¹æ³•reduceçš„å¦™ç”¨
date: 2021-09-30 15:15:25
permalink: /pages/8b7d10/
categories:
  - æ–‡ç« 
tags:
  - JavaScript
---

## å‰è¨€

`reduce`ä½œä¸ºJavaScriptçš„æ•°ç»„æ–¹æ³•ï¼Œç›¸æ¯”`map`ã€`forEach`ã€`filter`ç­‰å…¶ä»–å¸¸ç”¨è¿­ä»£æ–¹æ³•ï¼Œä½¿ç”¨åœºæ™¯å’Œä½¿ç”¨é¢‘ç‡å¯èƒ½å¹¶æ²¡æœ‰é‚£æ²¡é«˜ï¼Œå…¶ä¸­ä¹Ÿæœ‰æœ‹å‹é’Ÿçˆ±ä¸€å¾‹`for`å¾ªç¯ã€`map`æ–¹æ³•æ¢­å“ˆåˆ°åº•ç­‰ï¼Œä¸è¿‡ï¼Œä½œä¸ºJavaScriptçš„å†…ç½®æ•°ç»„æ–¹æ³•ï¼Œè‚¯å®šæœ‰ç¬¦åˆå®ƒçš„ä½¿ç”¨åœºæ™¯çš„æ—¶å€™ï¼Œæ¥ä¸‹æ¥å°±è®©æˆ‘ä»¬æ·±å…¥è¿™ä¸ªå°ä¼™ä¼´çš„å†…å¿ƒä¸–ç•Œ~

<!-- more -->

## åŸºæœ¬ç”¨æ³•

- **å®˜æ–¹æè¿°**ï¼š

`reduce()` æ–¹æ³•å¯¹æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ æ‰§è¡Œä¸€ä¸ªç”±æ‚¨æä¾›çš„**reducerå‡½æ•°**(å‡åºæ‰§è¡Œ)ï¼Œå°†å…¶ç»“æœæ±‡æ€»ä¸ºå•ä¸ªè¿”å›å€¼ã€‚

æˆ‘ä»¬æ¯”è¾ƒç†Ÿæ‚‰çš„å°±æ˜¯**ç´¯åŠ å™¨**

- **è¯­æ³•**ï¼š

`array.reduce(callback(accumulator, currentValue, currentIndex, arr), initialValue)`

`reduce` æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯ï¼š**callbackå›è°ƒå‡½æ•°**å’Œ**åˆå§‹å€¼(å¯é€‰)**

`reduce` ä¸ºæ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ ä¾æ¬¡æ‰§è¡Œ**callbackå‡½æ•°**ï¼Œä¸åŒ…æ‹¬æ•°ç»„ä¸­è¢«åˆ é™¤æˆ–ä»æœªè¢«èµ‹å€¼çš„å…ƒç´ ï¼Œæ¥å—å››ä¸ªå‚æ•°ï¼š

```js
// Accumulator (acc) (ç´¯è®¡å™¨)
// currentValue (cur) (å½“å‰å€¼)
// Current Index (idx) (å½“å‰ç´¢å¼•)
// Source Array (src) (æºæ•°ç»„)
```

**åˆå§‹å€¼**:

ä½œä¸ºç¬¬ä¸€æ¬¡è°ƒç”¨ `callback` å‡½æ•°æ—¶çš„ç¬¬ä¸€ä¸ªå‚æ•°çš„å€¼ ï¼ˆ`accumulator`ï¼‰ï¼Œ å¦‚æœæ²¡æœ‰æä¾›åˆå§‹å€¼ï¼Œåˆ™å°†ä½¿ç”¨æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚ åœ¨æ²¡æœ‰åˆå§‹å€¼çš„ç©ºæ•°ç»„ä¸Šè°ƒç”¨ `reduce` å°†æŠ¥é”™ã€‚

**æ³¨æ„**ï¼š

> å›è°ƒå‡½æ•°ç¬¬ä¸€æ¬¡æ‰§è¡Œæ—¶ï¼Œ`accumulator`å’Œ`currentValue`çš„å–å€¼æœ‰ä¸¤ç§æƒ…å†µï¼šå¦‚æœè°ƒç”¨`reduce()`æ—¶æä¾›äº†`initialValue`ï¼Œ`accumulator`å–å€¼ä¸º`initialValue`ï¼Œ`currentValue`å–æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå€¼ï¼›å¦‚æœæ²¡æœ‰æä¾› `initialValue`ï¼Œé‚£ä¹ˆ`accumulator`å–æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå€¼ï¼Œ`currentValue`å–æ•°ç»„ä¸­çš„ç¬¬äºŒä¸ªå€¼ã€‚

ä¸ºäº†æ›´å®‰å…¨çš„ä½¿ç”¨ä¸€èˆ¬å»ºè®®æä¾›ä¸€ä¸ªåˆå§‹é»˜è®¤å€¼ï¼Œå¦‚ï¼šæ•°ç»„(`[]`)ã€æ•°å€¼ç´¯åŠ  (`0`)ã€å¯¹è±¡(`{}`)ã€‚

ä¸€ä¸ªç®€å•çš„æ•°å€¼ç´¯åŠ å™¨ç”¨æ³•ï¼š

```js
const numArr=[0, 1, 2, 3, 4]

function callback(accumulator, currentValue, currentIndex, array){
  return accumulator + currentValue;
}

numArr.reduce(callback,0);

// 10
```

å®é™…ä¸Š`reduce`è¿˜æœ‰å¾ˆå¤šé‡è¦çš„ç”¨æ³•ï¼Œè¿™æ˜¯å› ä¸ºç´¯åŠ å™¨çš„å€¼å¯ä»¥ä¸å¿…ä¸º**ç®€å•ç±»å‹**ï¼ˆå¦‚æ•°å­—æˆ–å­—ç¬¦ä¸²ï¼‰ï¼Œå®ƒä¹Ÿå¯ä»¥æ˜¯**ç»“æ„åŒ–ç±»å‹**ï¼ˆå¦‚æ•°ç»„æˆ–å¯¹è±¡ï¼‰ï¼Œè¿™ä½¿å¾—æˆ‘ä»¬å¯ä»¥ç”¨å®ƒåšä¸€äº›å…¶ä»–æœ‰ç”¨çš„äº‹æƒ…ï¼Œæ¯”å¦‚ï¼š

- å°†æ•°ç»„è½¬æ¢ä¸ºå¯¹è±¡
- å±•å¼€æ›´å¤§çš„æ•°ç»„
- åœ¨ä¸€æ¬¡éå†ä¸­è¿›è¡Œä¸¤æ¬¡è®¡ç®—
- å°†æ˜ å°„å’Œè¿‡æ»¤å‡½æ•°ç»„åˆ
- æŒ‰é¡ºåºè¿è¡Œå¼‚æ­¥å‡½æ•°

## å°†æ•°ç»„è½¬æ¢ä¸ºå¯¹è±¡

æ³¨æ„è¿™é‡Œï¼šéœ€æŒ‡å®šåˆå§‹å€¼ğŸ‘‰ `{}`

```js
const arr = [
  {
    label: "name",
    value: "AJ",
  },
  {
    label: "age",
    value: 18,
  },
  {
    label: "address",
    value: "ä¸Šæµ·",
  },
]

const obj = arr.reduce(
  (accumulator, currentValue) => ({ ...accumulator, [currentValue.label]: currentValue.value }),
  {}
)
console.log(obj)
// { name: 'AJ', age: 18, address: 'ä¸Šæµ·' }
```

## æ•°ç»„åˆå¹¶ / treeç»“æ„æˆ–å¤šç»´æ•°ç»„è½¬æ¢ä¸ºä¸€ç»´æ•°ç»„

## ç”¨ reduce å®ç° Promise.all ä¸²è¡Œæ‰§è¡Œ

åœ¨å®é™…ä¸šåŠ¡ä¸­ï¼Œæœ‰æ—¶éœ€è¦å¼‚æ­¥å¤„ç†å¤šä¸ªä»»åŠ¡ï¼Œè¿™æ—¶æˆ‘ä»¬ä¸€èˆ¬ä¼šé€šè¿‡æ•°ç»„çš„å½¢å¼ç”¨`Promise.all`è¿›è¡Œå¤„ç†.ï¼ˆå¦‚ï¼šå¤šæ¥å£è¯·æ±‚ã€nodejsæ–‡ä»¶æ¨¡å—å¤šæ–‡ä»¶è¯»å–ã€å›¾ç‰‡æ‰¹é‡å‹ç¼©ç­‰ï¼‰

### Promise.all çš„åŸºæœ¬ç”¨æ³•

```js
const reuqest01 = new Promise((resolve) =>
  setTimeout(() => {
    console.log("reuqest01: 3000ms")
    resolve("reuqest01: 3000ms")
  }, 3000)
)

const reuqest02 = new Promise((resolve) =>
  setTimeout(() => {
    console.log("reuqest02: 1000ms")
    resolve("reuqest02: 1000ms")
  }, 1000)
)

const reuqest03 = new Promise((resolve) =>
  setTimeout(() => {
    console.log("reuqest03: 2000ms")
    resolve("reuqest03: 2000ms")
  }, 2000)
)

// é˜Ÿåˆ—
const requstList = [reuqest01, reuqest02, reuqest03]

console.time("time-used:")

Promise.all(requstList)
  .then((res) => {
    console.log("promise.all.then:", res)
    console.timeEnd("time-used:")
  })
  .catch((err) => {
    console.log("promise.all.catch:", err)
  })

// è¾“å‡ºæ—¥å¿—

// reuqest02: 1000ms
// reuqest03: 2000ms
// reuqest01: 3000ms
// promise.all.then: [ 'reuqest01: 3000ms', 'reuqest02: 1000ms', 'reuqest03: 2000ms' ]
// time-used:: 3005.211ms
```

è€—æ—¶ä¸ºå¹¶è¡Œæ—¶é—´ **3000ms**ï¼Œè¿è¡Œæ•ˆæœå›¾å¦‚ä¸‹ï¼š

![promise-1](https://cdn.jsdelivr.net/gh/JS-banana/images/vuepress/promise-1.gif)

**å°ç»“**ï¼š

1. `Promise.all` æ˜¯å¹¶è¡Œæ‰§è¡Œå…¶æ¥æ”¶åˆ°çš„ `promise` é˜Ÿåˆ—
2. å‡½æ•°æ‰§è¡Œç»“æœçš„å“åº”å…ˆåä¸å½±å“é˜Ÿåˆ—çš„æ’åˆ—
3. å³ä½¿åªæœ‰ä¸€ä¸ªå¤±è´¥ï¼Œä¹Ÿä¼šè¿”å›æ•´ä¸ªå¤±è´¥ï¼Œæ£€æµ‹åˆ°å¤±è´¥ç«‹å³åˆ¤å®šä¸ºå¤±è´¥

> `Promise.allSettled()`æ–¹æ³•ï¼šæˆåŠŸæˆ–å¤±è´¥å¯¹å…¶ä»–å‡½æ•°ä¸å½±å“ï¼Œå¯ä»¥å®Œæ•´çš„æ˜¾ç¤ºæ¯ä¸ªå‡½æ•°çš„è¿è¡Œç»“æœ

### Promise.all + reduce çš„ç”¨æ³•

åŒºåˆ«ï¼š**promiseå‡½æ•°**æ˜¯åœ¨`reduce`ä¸­æ‰§è¡Œæ—¶è°ƒç”¨çš„

```js
// é˜Ÿåˆ—
const requstList = [reuqest01, reuqest02, reuqest03 /*, reuqest04()*/]

requstList.reduce((prev, next) => prev.then(() => next()), Promise.resolve())

// è¾“å‡ºæ—¥å¿—
// åŒæ­¥æ‰§è¡Œï¼šreuqest01 => reuqest02 => reuqest03

// reuqest01: 3000ms
// reuqest02: 1000ms
// reuqest03: 2000ms
// time-used:: 6006.042ms
```

`reduce` æ˜¯åŒæ­¥æ‰§è¡Œçš„ï¼Œåœ¨ä¸€ä¸ªäº‹ä»¶å¾ªç¯å°±ä¼šå®Œæˆ,ä½†è¿™ä»…ä»…æ˜¯åœ¨å†…å­˜å¿«é€Ÿæ„é€ äº† `Promise` æ‰§è¡Œé˜Ÿåˆ—ï¼Œå±•å¼€å¦‚ä¸‹ï¼š

```js
new Promise((resolve, reject) => {
  // Promise 1
  resolve()
})
  .then((res) => {
    // Promise 2
    return res
  })
  .then((res) => {
    // Promise 3
    return res
  })
```

è€—æ—¶ä¸ºæ€»è®¡æ—¶é—´ **6000ms**ï¼Œè¿è¡Œæ•ˆæœå›¾å¦‚ä¸‹ï¼š

![promise-2](https://cdn.jsdelivr.net/gh/JS-banana/images/vuepress/promise-2.gif)

**å°ç»“**ï¼š

1. promiseå‡½æ•°æ˜¯åœ¨æ‰§è¡Œæ—¶è°ƒç”¨ï¼Œå’Œ `Prommise.all` æœ‰æ‰€åŒºåˆ«
2. `reduce` åˆå§‹é»˜è®¤å€¼æŒ‡å®š `Promise.resolve()` çŠ¶æ€ï¼Œç¡®ä¿å¼€å§‹æ‰§è¡Œ `.then` çš„çŠ¶æ€
3. `reduce` çš„ä½œç”¨å°±æ˜¯åœ¨å†…å­˜ä¸­ç”Ÿæˆè¿™ä¸ªé˜Ÿåˆ—ï¼Œè€Œä¸éœ€è¦æŠŠè¿™ä¸ªå†—ä½™çš„é˜Ÿåˆ—å†™åœ¨ä»£ç é‡Œï¼

### async await ç”¨æ³•å¤„ç†promiseé˜Ÿåˆ—

- `async await` åŸºæœ¬å†™æ³•ï¼š

```js
const fetchPromise = async () => {
  try {
    const res01 = await reuqest01()
    const res02 = await reuqest02()
    const res03 = await reuqest03()

    console.log("sucess:", res01, res02, res03)

    //  res04å‘ç”Ÿå¼‚å¸¸åï¼Œä¸ä¼šå†ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œæ§åˆ¶å°æ˜¯æ²¡æœ‰ "fail" æ‰“å°çš„
    const res04 = await reuqest04()
    console.log("fail")
  } catch (error) {
    console.log(error)
  }
}

fetchPromise()
```

å¯ä»¥å‘ç°è¿™ç§æ–¹å¼æ¯”è¾ƒç¹çï¼Œä¸”éœ€è¦try catché…åˆå¤„ç† errå¼‚å¸¸é—®é¢˜ï¼Œå½“å‡ºç°å¼‚å¸¸åä¾¿ä¸ä¼šç»§ç»­å¾€ä¸‹æ‰§è¡Œäº†ï¼Œè€Œæ˜¯ç›´æ¥è¿›å…¥ catchï¼Œè€Œä¸”å¯¹äºpromiseé˜Ÿåˆ—çš„å¤„ç†ä¹Ÿä¸æ˜¯å¾ˆæ–¹ä¾¿

- `async await`å‡½æ•° + `for of` å¾ªç¯é…åˆå†™æ³•

```js
async function runPromiseList(promiseList) {
  for (const request of promiseList) {
    try {
      const res = await request()
      console.log("res", res)
    } catch (error) {
      console.log("error:", error)
    }
  }
}

const delay = (time, arg, status = true) =>
  new Promise((resolve, reject) =>
    setTimeout(() => status ? resolve(arg) : reject(arg), time))

// æµ‹è¯• promise.all çš„è¿è¡Œé¡ºåº
const reuqest01 = async () => await delay(3000, "reuqest01: 3000ms")
const reuqest02 = async () => await delay(1000, "reuqest02: 1000ms")
const reuqest03 = async () => await delay(2000, "reuqest03: 2000ms")

const reuqest04 = async () => await delay(4000, "reuqest04: 4000ms", false)

runPromiseList([reuqest01, reuqest02, reuqest04, reuqest03])

// è¿™æ ·ä¹Ÿå¯ä»¥å®ç°åŒæ­¥æ‰§è¡Œ
// è¿›è¡Œé”™è¯¯æ•è·åä¸å½±å“æ‰§è¡Œ

// res reuqest01: 3000ms
// res reuqest02: 1000ms
// error: reuqest04: 4000ms
// res reuqest03: 2000ms
```

ä¸è¿‡è¦æ³¨æ„ï¼Œè¿™ä¸ªæ€è·¯ä¸ `reduce` æ€è·¯ä¸åŒä¹‹å¤„åœ¨äºï¼Œåˆ©ç”¨ `reduce` çš„å‡½æ•°æ•´ä½“æ˜¯ä¸ªåŒæ­¥å‡½æ•°ï¼Œè‡ªå·±å…ˆæ‰§è¡Œå®Œæ¯•æ„é€  `Promise` é˜Ÿåˆ—ï¼Œç„¶ååœ¨å†…å­˜å¼‚æ­¥æ‰§è¡Œï¼›è€Œåˆ©ç”¨ `async/await` çš„å‡½æ•°æ˜¯åˆ©ç”¨å°†è‡ªå·±æ”¹é€ ä¸ºä¸€ä¸ªå¼‚æ­¥å‡½æ•°ï¼Œç­‰å¾…æ¯ä¸€ä¸ª `Promise` æ‰§è¡Œå®Œæ¯•ã€‚

- æˆ–ä½¿ç”¨ç¬¬ä¸‰æ–¹ [async promise-fun](https://github.com/sindresorhus/promise-fun) å·¥å…·

## å‚è€ƒ

- [ç”¨ä¾‹ä»“åº“](https://github.com/JS-banana/native-javascript-learn)
- [MDN Array.prototype.reduce()](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce)
- [MDN Promise.all()](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise/all)
- [JavaScript ä¸­æ•°ç»„æ–¹æ³• reduce çš„å¦™ç”¨ä¹‹å¤„](https://juejin.cn/post/6844903861941993479)
- [ç²¾è¯»ã€Šç”¨ Reduce å®ç° Promise ä¸²è¡Œæ‰§è¡Œã€‹](https://github.com/ascoders/weekly/blob/master/%E5%89%8D%E6%B2%BF%E6%8A%80%E6%9C%AF/77.%E7%B2%BE%E8%AF%BB%E3%80%8A%E7%94%A8%20Reduce%20%E5%AE%9E%E7%8E%B0%20Promise%20%E4%B8%B2%E8%A1%8C%E6%89%A7%E8%A1%8C%E3%80%8B.md)
