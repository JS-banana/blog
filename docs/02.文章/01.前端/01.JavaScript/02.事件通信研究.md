---
title: JavaScriptäº‹ä»¶é€šä¿¡ç ”ç©¶
date: 2021-09-12 16:21:44
permalink: /pages/413e1f/
categories:
  - æ–‡ç« 
tags:
  - JavaScript
---

## å‰è¨€

å…¬å¸å‰æ®µæ—¶é—´å¼€å‘**Aé¡¹ç›®**çš„æ—¶å€™ï¼Œå› ä¸º**Aé¡¹ç›®**æ¶‰åŠçš„æ¨¡å—æ¯”è¾ƒå¤šï¼Œè€Œä¸”å¥½å¤šåˆæ˜¯å…·æœ‰ç›¸å½“ç‹¬ç«‹æ€§ç­‰ç‰¹ç‚¹çš„ï¼Œæ¯”å¦‚**ç¼–è¾‘å™¨æ¨¡å—**ã€**å¯è§†åŒ–ç¼–è¾‘æ¨¡å—**ã€**åŠ¨æ€è¡¨å•è‡ªå®šä¹‰é…ç½®æ¨¡å—**ã€**å¯¼èˆªæ åŠæƒé™é¡µé¢é…ç½®æ¨¡å—**ç­‰ã€‚

è€Œä¸”ï¼Œéƒ¨åˆ†åŠŸèƒ½æ¨¡å—åœ¨**Bé¡¹ç›®**ã€**Cé¡¹ç›®**ç­‰ä¸­ä¹Ÿæœ‰ä½¿ç”¨åˆ°ï¼Œæ‰€ä»¥ï¼Œç»¼åˆè€ƒè™‘ï¼Œè¿™äº›æ¨¡å—è¿˜æ˜¯ä½œä¸ºå•ç‹¬ç»„ä»¶æ¨¡å—å¼€å‘æ¯”è¾ƒåˆé€‚ï¼Œé€šè¿‡ç»Ÿä¸€çš„åŒ…ç®¡ç†ï¼Œå¦‚`npm`ï¼Œå¯ä»¥æ–¹ä¾¿å…¶ä»–äººå‘˜å’Œé¡¹ç›®å¿«é€Ÿæ·»åŠ ä½¿ç”¨ï¼Œé¿å…é‡å¤åŠ³åŠ¨ï¼Œä¹Ÿé¿å…å¤åˆ¶ç²˜è´´è¿™ç§ä¸æ˜“ç»´æŠ¤å’Œç¨³å®šä»¥åŠåŒæ­¥æ›´æ–°çš„éº»çƒ¦~

å…¶ä¸­ï¼Œæœ‰ä¸å°‘åœºæ™¯æ˜¯éœ€è¦è·¨ç»„ä»¶æ¨¡å—ä¼ å€¼çš„ã€‚è€Œæˆ‘ä»¬ä½¿ç”¨ç»„ä»¶çš„å¸¸è§„æ–¹å¼åŸºæœ¬æ˜¯é€šè¿‡ `import` è¿™ç§å¼•å¦‚ä¸€ä¸ªç»„ä»¶æ¨¡å—ï¼Œç„¶åé€šè¿‡`props`ä¼ å€¼çš„æ–¹å¼è¿›è¡Œæ¥æ”¶ï¼Œç±»ä¼¼`antd`è¿™ç§ã€‚é€šè¿‡çˆ¶ç»„ä»¶ **Parent**ç»“åˆ`props` ä¹Ÿå¯ä»¥å®ç° **Child1** å’Œ **Child2**çš„é€šä¿¡ï¼Œä½†æ˜¯è¿™æ ·å¯¹äºç»„ä»¶å†…éƒ¨åˆ†æ¨¡å—åµŒå¥—åˆæ¯”è¾ƒæ·±çš„ï¼Œæ“ä½œèµ·æ¥è€¦åˆæ€§æ¯”è¾ƒå¤§ï¼Œä¹Ÿæ¯”è¾ƒä¹±ï¼Œæ‰€ä»¥ï¼Œæˆ‘å°±åœ¨æƒ³å¦‚ä½•é™ä½è€¦åˆæ€§å¹¶å®ç°ç»„ä»¶é—´çš„ä¼ å€¼å’Œé€šä¿¡å‘¢~

<!-- more -->

ç®€å•çœ‹ä¸‹ä»£ç å’Œé€»è¾‘ç»“æ„

ä»£ç å¤§è‡´ç»“æ„

```tsx
import React from 'react'
import Child1 from 'M' // npmåŒ… M
import Child2 from 'N' // npmåŒ… N

const Parent:React.FC=()=>{

    return <div>
        <header>è¿™æ˜¯é¡µé¢header</header>

        <Child1 />
        <Child2 />

        {/* å…¶ä»–ç»„ä»¶ */}
        {/* ... */}

        <footer>è¿™æ˜¯é¡µé¢header</footer>
    </div>
}

export default  Parent
```

ç»„ä»¶ä¹‹é—´çš„å…³ç³»

![event-1](https://cdn.jsdelivr.net/gh/JS-banana/images/vuepress/event-1.png)

å¦‚å›¾æ‰€ç¤ºï¼Œ**Child1ç»„ä»¶**å†…éƒ¨åˆåˆ†ä¸ºå¾ˆå¤šçˆ¶å­å°æ¨¡å—ï¼Œè¿™æ—¶æˆ‘ä»¬éœ€è¦å’Œ**Child1**ä¸­åµŒå¥—æ¯”è¾ƒæ·±çš„**Eæ¨¡å—**è¿›è¡Œé€šä¿¡ï¼Œ`props`å’Œ`Context`æ–¹å¼éƒ½æœ‰ä¸€å®šçš„æˆæœ¬å’Œè€¦åˆæ€§ï¼Œè”æƒ³åˆ°`Vue`çš„`Event`äº‹ä»¶é€šä¿¡ä¼ å€¼ï¼Œæˆ‘è§‰å¾—æˆ–è®¸å¯ä»¥æ¢ä¸ªæ€è·¯è¯•ä¸€è¯•~

![emoji](https://cdn.jsdelivr.net/gh/JS-banana/images/emoji/3.jpg)

## äº‹ä»¶é€šä¿¡çš„å‡ ç§æ–¹å¼

### âœ¨Event Bus

ä¸»è¦å°±æ˜¯é€šè¿‡**å‘å¸ƒè®¢é˜…æ¨¡å¼**å®ç°ï¼Œè¿™ä¸ªæˆ‘åœ¨å¦ä¸€ç¯‡æ–‡ç« é‡Œæœ‰å†™è¿‡ [å‘å¸ƒè®¢é˜…æ¨¡å¼vsè§‚å¯Ÿè€…æ¨¡å¼](http://localhost:8080/pages/911929/)

å…·ä½“å®ç°å’ŒåŸç†å°±ä¸è¯´äº†ï¼Œç®€å•çœ‹ä¸‹ä½¿ç”¨æ–¹å¼

`yarn add events`

åˆ›å»º `src/utils/eventBus.ts`ï¼Œè¿›è¡Œå®ä¾‹åŒ–ï¼Œç¡®ä¿å®ä¾‹å”¯ä¸€ï¼Œä¹‹åä½¿ç”¨çš„æ—¶å€™ï¼Œéƒ½åº”è¯¥å¼•ç”¨è¿™ä¸ª

```ts
import { EventEmitter } from 'events'

// ä¿è¯å”¯ä¸€å®ä¾‹
const EventBus = new EventEmitter()

export default EventBus
```

#### ç®€å•å†™ä¸ªdemoæµ‹è¯•ä¸‹

ç›®å½•ç»“æ„å¦‚ä¸‹

```js
components-eventBus 
  â”œâ”€â”€ Parent 
  â”œâ”€â”€ Child1
  â”œâ”€â”€ Child2
utils
  â”œâ”€â”€ eventBus
```

`Parent`ç»„ä»¶

```tsx
import React from "react"
import Child1 from "./Child1"
import Child2 from "./Child2"

const Parent: React.FC = () => {
  return (
    <div className="parent-container">
      <div className="content-box">
        <Child1 />
        <Child2 />
      </div>
    </div>
  )
}

export default Parent
```

`Child1`ç»„ä»¶1

```tsx
import React, { useEffect, useState } from "react"
import EventBus from "../utils/eventBus"

interface StateProps {
  name: string
  age: number
  count: number
}

const PERSON_INIT: StateProps = {
  name: "å°æ˜",
  age: 18,
  count: 0,
}

const ChildA: React.FC = () => {
  const [state, setState] = useState<StateProps>(PERSON_INIT) // æœ¬ç»„ä»¶çš„ state
  const [recevie, setRecevie] = useState() // æ¥æ”¶æ¥è‡ªå…¶ä»–ç»„ä»¶çš„ state

  const eventRegister = (args: any) => {
    console.log("æˆ‘æ˜¯Child1ï¼Œæˆ‘æ¥æ”¶åˆ°äº†æ¥è‡ªChild2çš„æ¶ˆæ¯ï¼š", args)
    setRecevie(args)
  }

  useEffect(() => {
    // mount
    EventBus.on("msgTochild1", eventRegister)

    // unmount
    return () => {
      EventBus.off("msgTochild1", eventRegister)
    }
  }, [])

  const sendMsgToChild2 = () => {
    EventBus.emit("msgTochild2", state)
  }

  return (
    <div>
      <h2>Child1</h2>
      <article>
        <p>state:</p>
        <pre>{JSON.stringify(state, null, 2)}</pre>
        <br />
        <p>event recevie:</p>
        <pre>{JSON.stringify(recevie, null, 2)}</pre>
        <br />
        <button onClick={() => setState((prev) => ({ ...prev, count: prev.count + 1 }))}>
          count + 1
        </button>
        <button onClick={sendMsgToChild2}>sendMsgToChild2</button>
      </article>
    </div>
  )
}

export default ChildA
```

`Child2`ç»„ä»¶2

```tsx
import React, { useEffect, useState } from "react"
import EventBus from "../utils/eventBus"

interface ListProps {
  name: string
  age: number
  count: number
}

const LIST_INIT: ListProps[] = [
  {
    name: "å¼ ä¸‰",
    age: 10,
    count: 0,
  },
]

const ChildB: React.FC = () => {
  const [list, setlist] = useState<ListProps[]>(LIST_INIT) // æœ¬ç»„ä»¶çš„ state
  const [recevie, setRecevie] = useState() // æ¥æ”¶æ¥è‡ªå…¶ä»–ç»„ä»¶çš„ state

  const eventRegister = (args: any) => {
    console.log("æˆ‘æ˜¯Child2ï¼Œæˆ‘æ¥æ”¶åˆ°äº†æ¥è‡ªChild1çš„æ¶ˆæ¯ï¼š", args)
    setRecevie(args)
  }

  useEffect(() => {
    // mount
    EventBus.on("msgTochild2", eventRegister)

    // unmount
    return () => {
      EventBus.off("msgTochild2", eventRegister)
    }
  }, [])

  const sendMsgToChild1 = () => {
    EventBus.emit("msgTochild1", list)
  }

  return (
    <div>
      <h2>Child2</h2>
      <article>
        <p>list:</p>
        <pre>{JSON.stringify(list, null, 2)}</pre>
        <br />
        <p>event recevie:</p>
        <pre>{JSON.stringify(recevie, null, 2)}</pre>
        <br />
        <button onClick={() => setlist((prev) => [...prev, { name: "å°æ", age: 11, count: 0 }])}>
          count + 1
        </button>
        <button onClick={sendMsgToChild1}>sendMsgToChild1</button>
      </article>
    </div>
  )
}

export default ChildB
```

çœ‹ä¸‹æ•ˆæœ

![event-2](https://cdn.jsdelivr.net/gh/JS-banana/images/vuepress/event-2.gif)

ä¼ å€¼æ²¡å•¥é—®é¢˜ï¼Œé…åˆ `callback` å³å¯å®ŒæˆçŠ¶æ€çš„æ›´æ–°ï¼Œä¸è¿‡ï¼Œè¿™é‡Œæœ‰ä¸ªé—®é¢˜

é¦–å…ˆï¼Œæˆ‘ä»¬çš„éœ€æ±‚æ˜¯å’Œ**Child1ç»„ä»¶**çš„**Eæ¨¡å—**è¿›è¡Œé€šä¿¡ï¼Œç›®å‰è¿™ä¸ªç®€æ˜“demoåªæ˜¯éªŒè¯äº†`eventBus`é€šä¿¡ä¼ å€¼çš„å¯è¡Œæ€§ï¼Œå³**Child1**å¯¹**Child2**é€šä¿¡

ä½†è¿™é‡Œçš„**Child1**å…¶å®æ˜¯æˆ‘ä»¬æŠ½è±¡å‡ºæ¥çš„çš„æ¼”ç¤ºç»„ä»¶ï¼Œå®é™…åœºæ™¯ä¸­å®ƒåº”è¯¥æ˜¯æˆ‘ä»¬é€šè¿‡**npmåŒ…**-`M`å¼•å…¥çš„ç»„ä»¶ï¼Œå› æ­¤ï¼Œè¿™æ ·çœ‹æ¥æˆ‘ä»¬è¿˜æ˜¯è¦é€šè¿‡`props`å¯¹**Mç»„ä»¶**è¿›è¡Œä¼ å€¼é€šä¿¡ï¼Œæ¯•ç«Ÿæˆ‘ä»¬åªèƒ½ç›´æ¥æ¥è§¦åˆ°**Mç»„ä»¶**ï¼Œè€Œæ— æ³•æ¥è§¦åˆ°**Mç»„ä»¶**å†…çš„**Eæ¨¡å—**

å› ä¸º`eventBus`è¦ç¡®ä¿**å®ä¾‹å”¯ä¸€**ï¼Œè€Œæˆ‘ä»¬çš„`eventBus`å®ä¾‹æ˜¯æ”¾åœ¨çˆ¶ç»„ä»¶çš„é¡¹ç›®å†…çš„ï¼Œæ‰€ä»¥ï¼Œ**Mç»„ä»¶**ä¹Ÿæ˜¯æ— æ³•ç›´æ¥è·å–åˆ°å®ä¾‹åŒ–çš„`eventBus`ï¼Œæˆ‘ä»¬ä¸å¯èƒ½æŠŠ`eventBus`é€šè¿‡`Props`ä¼ é€’ä¸‹å»ï¼Œæ„Ÿè§‰è¿™æ ·åˆç»•å›æ¥äº†

ç›®å‰å¯è¡Œçš„æ–¹æ¡ˆï¼Œå°±æ˜¯æŠŠå®ä¾‹åŒ–åçš„`eventBus`æŒ‚è½½åˆ°ç»„ä»¶ä¸é€šè¿‡`props`å°±å¯ä»¥è®¿é—®åˆ°çš„åœ°æ–¹

- `window` å…¨å±€å±æ€§

```js
// Parentç»„ä»¶ æŒ‚è½½ EventBus åˆ° window
import EventBus from "../utils/eventBus"
window._MY_EVENTBUS_ = EventBus

// Mç»„ä»¶
const EventBus = window._MY_EVENTBUS_
```

å½“å‰é¡¹ç›®ä¸‹`window`æ˜¯å…¨å±€å”¯ä¸€ï¼Œä»»æ„ç»„ä»¶éƒ½å¯è®¿é—®ï¼Œä¸å—å±€é™ï¼Œçœ‹èµ·æ¥ä¼¼ä¹æ²¡é—®é¢˜

ä¸è¿‡è¿™é‡Œå­˜åœ¨ä¸€äº›é£é™©

- å˜é‡æ±¡æŸ“
- å®‰å…¨æ€§

å› æ­¤ï¼Œè¿™ç§æ–¹å¼ä¹Ÿä¸å»ºè®®ä½¿ç”¨~

### âœ¨JavaScript è‡ªå®šä¹‰äº‹ä»¶

ç›´æ¥ä½¿ç”¨**JavaScript**åŸç”Ÿè‡ªå®šä¹‰äº‹ä»¶ `Event` å’Œ `CustomEvent`ï¼Œå…ˆçœ‹ä¸‹ç”¨æ³•

#### 1. ğŸ¤“ä½¿ç”¨JavaScriptå†…ç½®çš„ Event æ„é€ å‡½æ•°

`const myEvent = new Event(typeName, option)`

- typeName ï¼š`DOMString` ç±»å‹ï¼Œè¡¨ç¤ºåˆ›å»ºäº‹ä»¶çš„åç§°ï¼›
- option ï¼š å¯é€‰é…ç½®é¡¹
  - `bubbles`ï¼šè¡¨ç¤ºè¯¥äº‹ä»¶æ˜¯å¦å†’æ³¡ï¼Œé»˜è®¤ `null`
  - `cancelable`ï¼šè¡¨ç¤ºè¯¥äº‹ä»¶èƒ½å¦è¢«å–æ¶ˆï¼Œé»˜è®¤ `false`
  - `composed`ï¼šæŒ‡ç¤ºäº‹ä»¶æ˜¯å¦ä¼šåœ¨å½±å­DOMæ ¹èŠ‚ç‚¹ä¹‹å¤–è§¦å‘ä¾¦å¬å™¨ï¼ˆå½±å­DOMï¼š`Shadow DOM`ï¼‰ï¼Œé»˜è®¤ `false`

ç¤ºä¾‹

```js
// åˆ›å»ºä¸€ä¸ªæ”¯æŒå†’æ³¡çš„ event-A äº‹ä»¶
const myEvent = new Event("event-A", { bubbles: true })

// è§¦å‘äº‹ä»¶
document.dispatchEvent(myEvent);
```

ä¼ å€¼ä¼¼ä¹ä¸å¤ªå¥½æå‘€ï¼Œè¯¥æ–¹å¼ä¼¼ä¹ä¸å¤ªé€‚åˆæˆ‘ä»¬çš„åœºæ™¯ï¼Œä¸‹ä¸€ä¸ª~

#### 2. ğŸ¤“ä½¿ç”¨JavaScriptå†…ç½®çš„ CustomEvent æ„é€ å‡½æ•°

`const myEvent = new CustomEvent(typeName, option)`

- typeName ï¼š`DOMString` ç±»å‹ï¼Œè¡¨ç¤ºåˆ›å»ºäº‹ä»¶çš„åç§°ï¼›
- option ï¼š å¯é€‰é…ç½®é¡¹
  - `detail`ï¼šè¡¨ç¤ºè¯¥äº‹ä»¶ä¸­éœ€è¦è¢«ä¼ é€’çš„æ•°æ®ï¼Œåœ¨ EventListener è·å–ï¼Œé»˜è®¤ `null`
  - `bubbles`ï¼šè¡¨ç¤ºè¯¥äº‹ä»¶æ˜¯å¦å†’æ³¡ï¼Œé»˜è®¤ `false`
  - `cancelable`ï¼šè¡¨ç¤ºè¯¥äº‹ä»¶èƒ½å¦è¢«å–æ¶ˆã€‚ï¼ˆå½±å­DOMï¼š`Shadow DOM`ï¼‰ï¼Œé»˜è®¤ `false`

ç¤ºä¾‹

```js
// åˆ›å»ºäº‹ä»¶
const myEvent = new CustomEvent("event-B", { detail: list })
// æ·»åŠ äº‹ä»¶
window.addEventListener("event-A", e=> console.log(e))
// æ´¾å‘äº‹ä»¶
window.dispatchEvent(myEvent)
```

åŒæ ·çš„ç®€å•å†™ä¸ªdemoæµ‹è¯•ä¸‹

ç›®å½•ç»“æ„å¦‚ä¸‹

```js
components-customEvent 
  â”œâ”€â”€ Parent 
  â”œâ”€â”€ Child1
  â”œâ”€â”€ Child2
```

`Parent`ç»„ä»¶å’Œä¸Šé¢ä¸€æ ·ï¼Œæ²¡å˜

`Child1`ç»„ä»¶1

```tsx
import React, { useEffect, useState } from "react"

interface StateProps {
  name: string
  dec: string
  count: number
}

const PERSON_INIT: StateProps = {
  name: "å°æ˜",
  dec: "Child1çš„CustomEventè‡ªå®šä¹‰äº‹ä»¶event-A",
  count: 0,
}

const ChildA: React.FC = () => {
  const [state, setState] = useState<StateProps>(PERSON_INIT)
  const [recevie, setRecevie] = useState()

  const eventRegister = (args: any) => {
    console.log("æˆ‘æ˜¯Child1ï¼Œæˆ‘æ¥æ”¶åˆ°äº†æ¥è‡ªChild2çš„æ¶ˆæ¯ï¼š", args)
    setRecevie(args.detail)
  }

  useEffect(() => {
    // mount
    window.addEventListener("event-B", eventRegister)

    // unmount
    return () => {
      window.removeEventListener("event-B", eventRegister)
    }
  }, [])

  const sendMsgToChild2 = () => {
    // åˆ›å»ºäº‹ä»¶
    const myEvent = new CustomEvent("event-A", { detail: state })
    // æ´¾å‘äº‹ä»¶
    window.dispatchEvent(myEvent)
  }

  return (
    <div>
      <h2>Child1</h2>
      <article>
        <p>state:</p>
        <pre>{JSON.stringify(state, null, 2)}</pre>
        <br />
        <p>event recevie:</p>
        <pre>{JSON.stringify(recevie, null, 2)}</pre>
        <br />
        <button onClick={() => setState((prev) => ({ ...prev, count: prev.count + 1 }))}>
          count + 1
        </button>
        <button onClick={sendMsgToChild2}>sendMsgToChild2</button>
      </article>
    </div>
  )
}

export default ChildA
```

`Child2`ç»„ä»¶2

```tsx
import React, { useEffect, useState } from "react"

interface ListProps {
  name: string
  dec: string
  count: number
}

const LIST_INIT: ListProps[] = [
  {
    name: "å°æ",
    dec: "Child2çš„CustomEventè‡ªå®šä¹‰äº‹ä»¶event-B",
    count: 0,
  },
]

const ChildB: React.FC = () => {
  const [list, setlist] = useState<ListProps[]>(LIST_INIT)
  const [recevie, setRecevie] = useState()

  const eventRegister = (args: any) => {
    console.log("æˆ‘æ˜¯Child2ï¼Œæˆ‘æ¥æ”¶åˆ°äº†æ¥è‡ªChild1çš„æ¶ˆæ¯ï¼š", args)
    setRecevie(args.detail)
  }

  useEffect(() => {
    // mount
    window.addEventListener("event-A", eventRegister)

    // unmount
    return () => {
      window.removeEventListener("event-A", eventRegister)
    }
  }, [])

  const sendMsgToChild1 = () => {
    // åˆ›å»ºäº‹ä»¶
    const myEvent = new CustomEvent("event-B", { detail: list })
    // æ´¾å‘äº‹ä»¶
    window.dispatchEvent(myEvent)
  }

  return (
    <div>
      <h2>Child2</h2>
      <article>
        <p>list:</p>
        <pre>{JSON.stringify(list, null, 2)}</pre>
        <br />
        <p>event recevie:</p>
        <pre>{JSON.stringify(recevie, null, 2)}</pre>
        <br />
        <button
          onClick={() =>
            setlist((prev) => [
              ...prev,
              { name: "å°æ", dec: "Child2çš„CustomEventè‡ªå®šä¹‰äº‹ä»¶event-B", count: 0 },
            ])
          }
        >
          person list + 1
        </button>
        <button onClick={sendMsgToChild1}>sendMsgToChild1</button>
      </article>
    </div>
  )
}

export default ChildB
```

çœ‹ä¸‹æ•ˆæœ

![event-3](https://cdn.jsdelivr.net/gh/JS-banana/images/vuepress/event-3.gif)

å¯ä»¥çœ‹åˆ°è¿™ä¸ªä¹Ÿæ˜¯å¯ä»¥æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚çš„ï¼Œå’Œä½¿ç”¨æ™®é€šçš„äº‹ä»¶ `addEventListener` å·®ä¸å¤šï¼Œé€šè¿‡ `callback` æ¥æ”¶äº‹ä»¶çš„ä¼ å€¼å’ŒçŠ¶æ€æ›´æ–°æ“ä½œï¼Œä½†æ˜¯æˆ‘ä»¬ä¹Ÿå¯ä»¥å‘ç°æœ‰äº›ä¸ä¸€æ ·çš„åœ°æ–¹

å³ï¼Œå®ƒä¸åƒ `EventBus` é‚£æ ·å¿…é¡»ä½¿ç”¨å•ä¸€å®ä¾‹ï¼Œæˆ‘ä»¬åªè¦æŒ‡å®šè‡ªå®šä¹‰äº‹ä»¶çš„ `typeName`ï¼Œå°±å¯ä»¥åœ¨ä»»æ„åœ°æ–¹è§¦å‘ä½¿ç”¨ï¼Œè€Œä¸”`React`å’Œ`Vue`è¿™ç§å•é¡µé¢åº”ç”¨éƒ½æ˜¯å•èŠ‚ç‚¹çš„ï¼Œåªå­˜`body`ä¸‹çš„`#root`æ ‡ç­¾ä¸Šï¼Œä¼¼ä¹ç”¨èµ·æ¥æ›´æ–¹ä¾¿ç®€å•~

è¯è¯´ä¸çŸ¥é“æœ‰æ²¡æœ‰å‘~

çœ‹äº†ä¸‹å…¼å®¹æ€§ï¼Œå¦‚ä¸‹

![event-4](https://cdn.jsdelivr.net/gh/JS-banana/images/vuepress/event-4.png)

IEè¿˜æ˜¯ç¨³å•ŠğŸ˜†ï¼ŒIEæµè§ˆå™¨æ˜¯ä¸æ”¯æŒ`CustomEvent.detail`çš„ï¼Œä¼¼ä¹Edge 14+æ‰å¼€å§‹æ”¯æŒï¼Œæ€ä¹ˆåŠï¼Œéš¾é“IEæµè§ˆå™¨å°±ä¸èƒ½ä½¿ç”¨çš„å—ï¼Ÿ

è¿™é‡Œè´´ä¸€ä»½å¼ é‘«æ—­åšå®¢æä¾›çš„Polyfillæ–¹æ¡ˆï¼Œcv~

```js
/**
 * CustomEvent constructor polyfill for IE
 */
(function () {
    if (typeof window.CustomEvent === 'function') {
        // å¦‚æœä¸æ˜¯IE
        return false;
    }

    var CustomEvent = function (event, params) {
        params = params || {
            bubbles: false,
            cancelable: false,
            detail: undefined
        };
        var evt = document.createEvent('CustomEvent');
        evt.initCustomEvent(event, params.bubbles, params.cancelable, params.detail);
        return evt;
    };

    CustomEvent.prototype = window.Event.prototype;

    window.CustomEvent = CustomEvent;
})();
```

## ç»“è¯­

OKï¼Œåˆ°æ­¤ç»“æŸ

äº‹ä»¶æœ¬è´¨æ˜¯ä¸€ç§æ¶ˆæ¯ï¼Œäº‹ä»¶æ¨¡å¼æœ¬è´¨ä¸Šæ˜¯**è§‚å¯Ÿè€…æ¨¡å¼**çš„å®ç°ï¼Œå³èƒ½ç”¨è§‚å¯Ÿè€…æ¨¡å¼çš„åœ°æ–¹ï¼Œè‡ªç„¶ä¹Ÿèƒ½ç”¨**äº‹ä»¶æ¨¡å¼**ã€‚

åˆå›åˆ°äº†**è§‚å¯Ÿè€…æ¨¡å¼**äº†å‘€~

![emoji](https://cdn.jsdelivr.net/gh/JS-banana/images/emoji/1.jpg)

## å‚è€ƒ

- [CustomEvent - MDN](https://developer.mozilla.org/zh-CN/docs/Web/API/CustomEvent)
- [JavaScript è‡ªå®šä¹‰äº‹ä»¶å¦‚æ­¤ç®€å•ï¼](https://juejin.cn/post/6844904069820055560)
- [JS CustomEventè‡ªå®šä¹‰äº‹ä»¶ä¼ å‚å°æŠ€å·§](https://www.zhangxinxu.com/wordpress/2020/08/js-customevent-pass-param/)
