---
title: 虚拟列表——你需要知道的优雅处理大数据渲染的技巧
date: 2023-03-30 15:46:18
permalink: /pages/c8aad6/
categories:
  - 文章
  - 前端
tags:
  - vue
---

2023年了，你还不会高性能渲染吗？1万？10万？条数据，根本不怂，虚拟列表高性能渲染实战！

<!-- more -->

## 前言

按照我们常规理解，数据量较大时一般都是通过分页进行解决处理，对于Table组件类这种列表展示我们应该很熟悉了。

分页可以实现最小化接口数据量，后端根据前端传入的参数，返回指定的范围数据。毕竟我给你1000条数据，你也很难用一屏把全部数据展示出来（别杠，就是一个字“优雅”🤡）

就一般场景而言，以后端分页为主。但是，也不排除一些特殊业务场景，需要返回大量数据的情况（别杠，就是一个字“业务场景”🤡）

这里我们主要讨论长列表的场景，当存在在大量数据返回的情况下（如 Select 组件），如何优雅的高性能渲染

## 背景

结合我司实际使用场景为例：

有这样一个类似 Input + Select 组件的高级业务封装组件，可选列表数据根据输入内容动态变化，每一项嵌套有多个div、span标签以及img等元素，整个容器元素会频繁关闭、开启，触发重新渲染，需要渲染的字典数据接口是全部返回的，一般是600条以上。

简单分析下：

1. 接口返回数据量较大，考虑到列表每一项存在多个嵌套标签元素，在创建节点、渲染数据的时候会比较消耗性能
2. 列表数据动态变化、频繁开关，表示整个元素会频繁触发创建节点、渲染的流程

## 分析

为了更加清晰的表现出耗时瓶颈，这里我以1万条数据为例，分析创建一万个节点的消耗占比

根据耗时结果，分析可得出：

1. js运行时间为22ms，还是比较快的
2. 总运行时间达到了748ms，耗时瓶颈主要集中在这里

根据JavaScript的执行逻辑，结合Chrome performance工具可以进一步分析得出如下结果：

JS的运行是单线程的，他会从执行栈中依次执行每一个任务，基本顺序为 宏任务=>微任务=>渲染 setTimeout

因为列表数据每次呈现的都不一样，需要尽量做到最小开销的渲染
