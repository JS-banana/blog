---
title: rollup系列之——构建发布一个npm包
date: 2021-07-09 14:53:32
permalink: /pages/b849f8/
categories:
  - 前端
tags:
  - 构建工具
---

## 背景

我们在项目开发的过程中，经常会封装组件与一些函数库方便使用。但每次开发不同项目时都要花费时间重新开发，其实很多组件与工具函数在多数场景都是可复用的。所以，我打算把日常使用频率较高的组件和函数库进行逻辑封装，发布成一个`npm`包小工具库等，这样做，一来可以借机完善组件与工具库业务逻辑，二来可以熟悉不同工具对打包构建的流程，最后还可以实战下`npm`发包。

<!-- more -->

虽然有大量现成的类库，类似`lodash`、`moment`这种，但对于其内部实现我们却很少了解，只是简单的使用。当然我们不可能把所有开源的源码都看一遍，但对于一些优秀的开源类库，还是很有必要学习下的，了解其内部实现逻辑与原理对于自身技术提升也是很有帮助的~

特别是开源项目的工程化配置与各种标准规范，具有很高的学习价值，`redux`的包发布方式就是采用的`rollup`，我们可以参照其实现方式来实现一个我们自己的`npm`包。

这篇文章主要就是记录我在使用`rollup`构建、发包的一些心得体会，如有错误，欢迎指正~

## 目标

1. 现阶段开源项目基于`ES6`的写法越来越普遍，所以我们发布的包必须支持`ESM`标准。
2. 因为还有不少项目是基于`nodejs`环境开发，使用的是`commonjs`协议，所以也应该做到对`CJS`的支持。
3. 当前也必须要支持浏览器环境以`CDN`的形式直接引入使用，所以也要做到对`UMD`的支持。

- 支持以 `Typescript` 语法开发
- 支持以 `ES6` 语法开发
- 支持导出 `ES module` 规范
- 支持导出 `commonjs` 规范
- 支持导出 `umd` 规范
- 支持配置兼容版本
- 支持 `tree-shaking`
- 支持代码压缩

## 介绍

本篇文章不做入门介绍，我们主要按业务需求做一些必要介绍，确保对整个逻辑有比较清晰的认识。

> 使用及运行原理会在接下来的rollup系列相关文章中输出。

## 参考

> [什么是amd、commonjs、umd、esm](https://juejin.cn/post/6844903978333896718)
