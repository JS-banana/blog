---
title: 搭建web服务
date: 2020-09-13 14:39:38
permalink: /pages/5cd35f/
categories: 
  - 技术
  - Nginx
tags: 
  - 
---

## nginx.conf

- 主文件基本配置

```conf
error_log logs/error.log;    #日志

worker_processes 2;
events {
    worker_connections 1024;  #最大连接数
}

http {
    access_log off;

    keepalive_timeout 65;    #超时时间
    types_hash_max_size 2048;

    include conf.d/*.conf;   #引入并使用conf.d下的所有.conf配置
}
```

## conf.d/xx.conf

- 单独配置 server

```conf
server {
    #外网
    listen 443 ssl default_server; #端口  #listen 443 ssl http2 开启http2
    server_name www.xxx.com; #域名

    #https ssl加密
    ssl_certificate cert/xxx.com.pem;
    ssl_certificate_key cert/xxx.com.key;
    ssl_session_cache shared:SSL:1m;
    ssl_session_timeout 10m;
    ssl_ciphers HIGH:!aNULL:!MD5;
    ssl_prefer_server_ciphers on;

    #开启gzip配置
    # gzip setting
    gzip on;
    gzip_min_length 1k; #开始压缩的最小长度(再小就不要压缩了,意义不在)
    gzip_comp_level 6;  #[1-9] 推荐6 压缩级别(级别越高,压的越小,越浪费CPU计算资源)
    gzip_types text/plain application/javascript application/x-javascript text/css application/xml text/xml text/javascript application/json;
    gzip_static on;
    gzip_vary on;
    gzip_buffers 4 16k; #缓冲(压缩在内存中缓冲几块? 每块多大?)
    //非必要配置
    gzip_disable #正则匹配UA 什么样的Uri不进行gzip
    #监听本地服务

    location / {
        #开启反向代理
        proxy_set_header Host $host;
        proxy_headers_hash_max_size 1024;
        proxy_headers_hash_bucket_size 128;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for ;
        proxy_set_header Accept-Encoding "";
        proxy_pass http://127.0.0.1:3021/;
    }
}
```

### 检查 nginx 配置

1.检查配置：`/usr/local/nginx/sbin/nginx -t`

2.重启：`/usr/local/nginx/sbin/nginx -s reload`

3.查看进程：`ps -ef | grep nginx` //ps -ef 查看进程列表， | grep

4.显示 tcp，udp 的端口和进程等相关情况：`netstat -tunlp | grep` 端口号

#### 检查 nginx.conf 是否成功，nginx -t 只会检查默认路径的

- nginx 项目下直接 `nginx -t`
- 其他任何位置 `nginx -t -c /home/admin/nginx/nginx.conf`

#### 重启配置

- nginx 项目下直接 `nginx -s`
- 其他任何位置 /usr/local/openresty/nginx/sbin/nginx -p `pwd`/ -c nginx.conf -s reload
