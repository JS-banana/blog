(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{535:function(v,t,_){"use strict";_.r(t);var e=_(43),a=Object(e.a)({},(function(){var v=this,t=v.$createElement,_=v._self._c||t;return _("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[_("div",{staticClass:"custom-block tip"},[_("p",{staticClass:"custom-block-title"},[v._v("提示")]),v._v(" "),_("p",[v._v("本篇文章尚处在编写状态中...")])]),v._v(" "),_("h2",{attrs:{id:"背景"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#背景"}},[v._v("#")]),v._v(" 背景")]),v._v(" "),_("p",[v._v("我们在项目开发的过程中，经常会封装组件与一些函数库方便使用。但每次开发不同项目时都要花费时间重新开发，其实很多组件与工具函数在多数场景都是可复用的。所以，我打算把日常使用频率较高的组件和函数库进行逻辑封装，发布成一个"),_("code",[v._v("npm")]),v._v("包小工具库等，这样做，一来可以借机完善组件与工具库业务逻辑，二来可以熟悉不同工具对打包构建的流程，最后还可以实战下"),_("code",[v._v("npm")]),v._v("发包。")]),v._v(" "),_("p",[v._v("虽然有大量现成的类库，类似"),_("code",[v._v("lodash")]),v._v("、"),_("code",[v._v("moment")]),v._v("这种，但对于其内部实现我们却很少了解，只是简单的使用。当然我们不可能把所有开源的源码都看一遍，但对于一些优秀的开源类库，还是很有必要学习下的，了解其内部实现逻辑与原理对于自身技术提升也是很有帮助的~")]),v._v(" "),_("p",[v._v("特别是开源项目的工程化配置与各种标准规范，具有很高的学习价值，"),_("code",[v._v("redux")]),v._v("的包发布方式就是采用的"),_("code",[v._v("rollup")]),v._v("，我们可以参照其实现方式来实现一个我们自己的"),_("code",[v._v("npm")]),v._v("包。")]),v._v(" "),_("p",[v._v("这篇文章主要就是记录我在使用"),_("code",[v._v("rollup")]),v._v("构建、发包的一些心得体会，如有错误，欢迎指正~")]),v._v(" "),_("h2",{attrs:{id:"目标"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#目标"}},[v._v("#")]),v._v(" 目标")]),v._v(" "),_("ol",[_("li",[v._v("现阶段开源项目基于"),_("code",[v._v("ES6")]),v._v("的写法越来越普遍，所以我们发布的包必须支持"),_("code",[v._v("ESM")]),v._v("标准。")]),v._v(" "),_("li",[v._v("因为还有不少项目是基于"),_("code",[v._v("nodejs")]),v._v("环境开发，使用的是"),_("code",[v._v("commonjs")]),v._v("协议，所以也应该做到对"),_("code",[v._v("CJS")]),v._v("的支持。")]),v._v(" "),_("li",[v._v("当然也必须要支持浏览器环境以"),_("code",[v._v("CDN")]),v._v("的形式直接引入使用，所以也要做到对"),_("code",[v._v("UMD")]),v._v("的支持。（该模式支持浏览器和Nodejs）")])]),v._v(" "),_("ul",[_("li",[v._v("支持以 "),_("code",[v._v("Typescript")]),v._v(" 语法开发")]),v._v(" "),_("li",[v._v("支持以 "),_("code",[v._v("ES6")]),v._v(" 语法开发")]),v._v(" "),_("li",[v._v("支持导出 "),_("code",[v._v("ES module")]),v._v(" 规范")]),v._v(" "),_("li",[v._v("支持导出 "),_("code",[v._v("commonjs")]),v._v(" 规范")]),v._v(" "),_("li",[v._v("支持导出 "),_("code",[v._v("umd")]),v._v(" 规范")]),v._v(" "),_("li",[v._v("支持配置兼容版本")]),v._v(" "),_("li",[v._v("支持 "),_("code",[v._v("tree-shaking")])]),v._v(" "),_("li",[v._v("支持代码压缩")])]),v._v(" "),_("h2",{attrs:{id:"介绍"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#介绍"}},[v._v("#")]),v._v(" 介绍")]),v._v(" "),_("p",[v._v("本篇文章不做入门使用介绍，我们主要按业务需求做一些必要说明，以确保对整个逻辑有比较清晰的认识。")]),v._v(" "),_("h3",{attrs:{id:"前言"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[v._v("#")]),v._v(" 前言")]),v._v(" "),_("p",[v._v("市面上知名的库，如"),_("code",[v._v("Vue")]),v._v("、"),_("code",[v._v("React")]),v._v("、"),_("code",[v._v("D3")]),v._v("、"),_("code",[v._v("Redux")]),v._v("等项目都是使用的"),_("code",[v._v("Rollup")]),v._v("进行构建打包，而目前尤大新出的最火热的"),_("code",[v._v("Vite")]),v._v("构建工具在打包构建项目时也是使用的"),_("code",[v._v("Rollup")]),v._v("。")]),v._v(" "),_("p",[_("code",[v._v("Rollup")]),v._v("从设计之初就是面向"),_("code",[v._v("ES module")]),v._v("的，它诞生时"),_("code",[v._v("AMD")]),v._v("、"),_("code",[v._v("CMD")]),v._v("、"),_("code",[v._v("UMD")]),v._v("的格式之争还很火热，作者希望充分利用"),_("code",[v._v("ES module")]),v._v("机制，构建出"),_("code",[v._v("结构扁平")]),v._v("，"),_("code",[v._v("性能出众")]),v._v("的类库。")]),v._v(" "),_("h3",{attrs:{id:"es-module"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#es-module"}},[v._v("#")]),v._v(" ES Module")]),v._v(" "),_("p",[_("code",[v._v("ES module")]),v._v("的设计思想是尽量的"),_("strong",[v._v("静态化")]),v._v("，使得"),_("strong",[v._v("编译时就能确定模块的依赖关系")]),v._v("，以及输入和输出的变量。"),_("code",[v._v("CommonJS")]),v._v(" 和 "),_("code",[v._v("AMD")]),v._v(" 模块，都只能在"),_("strong",[v._v("运行时")]),v._v("确定这些东西，举例来说：")]),v._v(" "),_("ol",[_("li",[_("code",[v._v("ES import")]),v._v("只能作为模块顶层的语句出现，不能出现在 "),_("code",[v._v("function")]),v._v(" 里面或是 "),_("code",[v._v("if")]),v._v(" 里面。")]),v._v(" "),_("li",[_("code",[v._v("ES import")]),v._v("的模块名只能是字符串常量。")]),v._v(" "),_("li",[v._v("不管 "),_("code",[v._v("import")]),v._v(" 的语句出现的位置在哪里，在模块初始化的时候所有的 "),_("code",[v._v("import")]),v._v(" 都必须已经导入完成。")]),v._v(" "),_("li",[_("code",[v._v("import binding")]),v._v(" 是 "),_("code",[v._v("immutable")]),v._v(" 的，类似 "),_("code",[v._v("const")]),v._v("。比如说你不能 "),_("code",[v._v("import { a } from './a'")]),v._v(" 然后给 "),_("code",[v._v("a")]),v._v(" 赋值个其他什么东西。")])]),v._v(" "),_("p",[v._v("这些设计虽然使得灵活性不如"),_("code",[v._v("CommonJS")]),v._v("的"),_("code",[v._v("require")]),v._v("，但却保证了 "),_("code",[v._v("ES modules")]),v._v(" 的依赖关系是确定的，和运行时的状态无关，从而也就保证了"),_("code",[v._v("ES modules")]),v._v("是可以进行可靠的静态分析的。")]),v._v(" "),_("h3",{attrs:{id:"概述"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[v._v("#")]),v._v(" 概述")]),v._v(" "),_("p",[_("code",[v._v("Rollup")]),v._v(" 是一个使用新的ES6标准化格式的 "),_("code",[v._v("JavaScript")]),v._v(" 模块打包器，可以将小块代码编译成大块复杂的代码。通过 "),_("code",[v._v("Tree-shaking")]),v._v(" 静态分析代码中的 "),_("code",[v._v("import")]),v._v("，排除任何未实际使用的代码。")]),v._v(" "),_("h3",{attrs:{id:"tree-shaking-是什么"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#tree-shaking-是什么"}},[v._v("#")]),v._v(" Tree-shaking 是什么")]),v._v(" "),_("p",[_("code",[v._v("Tree-shaking")]),v._v(', 也被称为 "live code inclusion," 它是清除实际上并没有在给定项目中使用的代码的过程，但是它可以更加高效。')]),v._v(" "),_("ul",[_("li",[v._v("在使用 "),_("code",[v._v("CommonJS")]),v._v(" 时，必须导入("),_("code",[v._v("import")]),v._v(")完整的工具("),_("code",[v._v("tool")]),v._v(")或库("),_("code",[v._v("library")]),v._v(")对象。")])]),v._v(" "),_("div",{staticClass:"language-js line-numbers-mode"},[_("pre",{pre:!0,attrs:{class:"language-js"}},[_("code",[_("span",{pre:!0,attrs:{class:"token comment"}},[v._v("// 使用 CommonJS 导入(import)完整的 utils 对象")]),v._v("\n"),_("span",{pre:!0,attrs:{class:"token keyword"}},[v._v("var")]),v._v(" utils "),_("span",{pre:!0,attrs:{class:"token operator"}},[v._v("=")]),v._v(" "),_("span",{pre:!0,attrs:{class:"token function"}},[v._v("require")]),_("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v("(")]),v._v(" "),_("span",{pre:!0,attrs:{class:"token string"}},[v._v("'utils'")]),v._v(" "),_("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v(")")]),_("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v(";")]),v._v("\n"),_("span",{pre:!0,attrs:{class:"token keyword"}},[v._v("var")]),v._v(" query "),_("span",{pre:!0,attrs:{class:"token operator"}},[v._v("=")]),v._v(" "),_("span",{pre:!0,attrs:{class:"token string"}},[v._v("'Rollup'")]),_("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v(";")]),v._v("\n"),_("span",{pre:!0,attrs:{class:"token comment"}},[v._v("// 使用 utils 对象的 ajax 方法")]),v._v("\nutils"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v(".")]),_("span",{pre:!0,attrs:{class:"token function"}},[v._v("ajax")]),_("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v("(")]),v._v(" "),_("span",{pre:!0,attrs:{class:"token string"}},[v._v("'https://api.example.com?search='")]),v._v(" "),_("span",{pre:!0,attrs:{class:"token operator"}},[v._v("+")]),v._v(" query "),_("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v(")")]),_("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v(".")]),_("span",{pre:!0,attrs:{class:"token function"}},[v._v("then")]),_("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v("(")]),v._v(" handleResponse "),_("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v(")")]),_("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v(";")]),v._v("\n")])]),v._v(" "),_("div",{staticClass:"line-numbers-wrapper"},[_("span",{staticClass:"line-number"},[v._v("1")]),_("br"),_("span",{staticClass:"line-number"},[v._v("2")]),_("br"),_("span",{staticClass:"line-number"},[v._v("3")]),_("br"),_("span",{staticClass:"line-number"},[v._v("4")]),_("br"),_("span",{staticClass:"line-number"},[v._v("5")]),_("br")])]),_("ul",[_("li",[v._v("但是在使用 "),_("code",[v._v("ES6")]),v._v(" 模块时，无需导入整个 "),_("code",[v._v("utils")]),v._v(" 对象，我们可以只导入("),_("code",[v._v("import")]),v._v(")我们所需的 "),_("code",[v._v("ajax")]),v._v(" 函数：")])]),v._v(" "),_("div",{staticClass:"language-js line-numbers-mode"},[_("pre",{pre:!0,attrs:{class:"language-js"}},[_("code",[_("span",{pre:!0,attrs:{class:"token comment"}},[v._v("// 使用 ES6 import 语句导入(import) ajax 函数")]),v._v("\n"),_("span",{pre:!0,attrs:{class:"token keyword"}},[v._v("import")]),v._v(" "),_("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v("{")]),v._v(" ajax "),_("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v("}")]),v._v(" "),_("span",{pre:!0,attrs:{class:"token keyword"}},[v._v("from")]),v._v(" "),_("span",{pre:!0,attrs:{class:"token string"}},[v._v("'utils'")]),_("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v(";")]),v._v("\n"),_("span",{pre:!0,attrs:{class:"token keyword"}},[v._v("var")]),v._v(" query "),_("span",{pre:!0,attrs:{class:"token operator"}},[v._v("=")]),v._v(" "),_("span",{pre:!0,attrs:{class:"token string"}},[v._v("'Rollup'")]),_("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v(";")]),v._v("\n"),_("span",{pre:!0,attrs:{class:"token comment"}},[v._v("// 调用 ajax 函数")]),v._v("\n"),_("span",{pre:!0,attrs:{class:"token function"}},[v._v("ajax")]),_("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v("(")]),v._v(" "),_("span",{pre:!0,attrs:{class:"token string"}},[v._v("'https://api.example.com?search='")]),v._v(" "),_("span",{pre:!0,attrs:{class:"token operator"}},[v._v("+")]),v._v(" query "),_("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v(")")]),_("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v(".")]),_("span",{pre:!0,attrs:{class:"token function"}},[v._v("then")]),_("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v("(")]),v._v(" handleResponse "),_("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v(")")]),_("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v(";")]),v._v("\n")])]),v._v(" "),_("div",{staticClass:"line-numbers-wrapper"},[_("span",{staticClass:"line-number"},[v._v("1")]),_("br"),_("span",{staticClass:"line-number"},[v._v("2")]),_("br"),_("span",{staticClass:"line-number"},[v._v("3")]),_("br"),_("span",{staticClass:"line-number"},[v._v("4")]),_("br"),_("span",{staticClass:"line-number"},[v._v("5")]),_("br")])]),_("p",[v._v("因为 "),_("code",[v._v("Rollup")]),v._v(" 只引入最基本最精简代码，所以可以生成轻量、快速，以及低复杂度的 "),_("code",[v._v("library")]),v._v(" 和应用程序。因为这种基于显式的 "),_("code",[v._v("import")]),v._v(" 和 "),_("code",[v._v("export")]),v._v(" 语句的方式，它远比「在编译后的输出代码中，简单地运行自动 "),_("code",[v._v("minifier")]),v._v(" 检测未使用的变量」更有效。")]),v._v(" "),_("h3",{attrs:{id:"rollup-对比-webpack"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#rollup-对比-webpack"}},[v._v("#")]),v._v(" Rollup 对比 Webpack")]),v._v(" "),_("p",[v._v("首先我们要清楚这两种工具的定位是不同的。")]),v._v(" "),_("p",[_("code",[v._v("rollup")]),v._v(" 倾向于类库方向，而"),_("code",[v._v("webpack")]),v._v("则是倾向于复杂"),_("code",[v._v("SPA")]),v._v("的模块化应用构建。")]),v._v(" "),_("p",[v._v("就目前"),_("code",[v._v("webpack")]),v._v("的强大生态在构建应用程序开发上市具有很大的优势的，各种"),_("strong",[v._v("工具")]),v._v("、"),_("strong",[v._v("loader")]),v._v("、"),_("strong",[v._v("plugin")]),v._v("都很全面。")]),v._v(" "),_("h4",{attrs:{id:"webpack"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#webpack"}},[v._v("#")]),v._v(" webpack")]),v._v(" "),_("ul",[_("li",[v._v("强大的插件生态")]),v._v(" "),_("li",[v._v("通过"),_("code",[v._v("loader")]),v._v("处理各种各样的资源依赖")]),v._v(" "),_("li",[_("code",[v._v("HMR")]),v._v("模块热替换")]),v._v(" "),_("li",[v._v("按需加载、路由拆分、资源缓存")]),v._v(" "),_("li",[v._v("提取公共模块")]),v._v(" "),_("li",[v._v("支持各类型的模块依赖处理")])]),v._v(" "),_("h4",{attrs:{id:"rollup"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#rollup"}},[v._v("#")]),v._v(" rollup")]),v._v(" "),_("ul",[_("li",[v._v("编译出来的代码"),_("strong",[v._v("可读性好")])]),v._v(" "),_("li",[v._v("不会像"),_("code",[v._v("webpack")]),v._v("打包后会生成"),_("code",[v._v("__webpack_require__")]),v._v("等冗余"),_("code",[v._v("runtime")]),v._v("代码，相对干净和小巧。")]),v._v(" "),_("li",[v._v("支持"),_("code",[v._v("tree-shaking")])]),v._v(" "),_("li",[v._v("支持导出"),_("code",[v._v("es")]),v._v("模块文件（"),_("code",[v._v("webpack")]),v._v("不支持导出"),_("code",[v._v("es")]),v._v("模块）")])]),v._v(" "),_("h4",{attrs:{id:"缺点"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#缺点"}},[v._v("#")]),v._v(" 缺点")]),v._v(" "),_("ul",[_("li",[v._v("模块过于静态化，HMR很难实现")]),v._v(" "),_("li",[v._v("仅面向"),_("code",[v._v("ES module")]),v._v("，无法可靠的处理"),_("code",[v._v("commonjs")]),v._v("以及"),_("code",[v._v("umd")]),v._v("依赖")])]),v._v(" "),_("h3",{attrs:{id:"为什么使用rollup"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#为什么使用rollup"}},[v._v("#")]),v._v(" 为什么使用rollup")]),v._v(" "),_("p",[_("code",[v._v("rollup")]),v._v("不是为了替代"),_("code",[v._v("webpack")]),v._v("而出现，"),_("code",[v._v("webpack")]),v._v("有自身丰富的生态圈，但"),_("code",[v._v("webpack")]),v._v("对于多模块打开之后产生的额外开销有很多，比如各种没用的依赖，使用"),_("code",[v._v("webpack")]),v._v("打包，你会发现，原来只有几"),_("code",[v._v("kb")]),v._v("的文件，打包后会多出很多无关的代码。")]),v._v(" "),_("h2",{attrs:{id:"开干"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#开干"}},[v._v("#")]),v._v(" 开干")]),v._v(" "),_("h2",{attrs:{id:"总结"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[v._v("#")]),v._v(" 总结")]),v._v(" "),_("h2",{attrs:{id:"参考"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[v._v("#")]),v._v(" 参考")]),v._v(" "),_("ul",[_("li",[_("a",{attrs:{href:"https://rollupjs.org/guide/zh/",target:"_blank",rel:"noopener noreferrer"}},[v._v("https://rollupjs.org/guide/zh/"),_("OutboundLink")],1)]),v._v(" "),_("li",[_("a",{attrs:{href:"https://juejin.cn/post/6844903978333896718",target:"_blank",rel:"noopener noreferrer"}},[v._v("什么是amd、commonjs、umd、esm"),_("OutboundLink")],1)]),v._v(" "),_("li",[_("a",{attrs:{href:"https://segmentfault.com/a/1190000038708512",target:"_blank",rel:"noopener noreferrer"}},[v._v("为什么说rollup比webpack更适合打包库"),_("OutboundLink")],1)]),v._v(" "),_("li",[_("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/75717476",target:"_blank",rel:"noopener noreferrer"}},[v._v("【第九期】Rollup：下一代ES模块打包工具"),_("OutboundLink")],1)])])])}),[],!1,null,null,null);t.default=a.exports}}]);